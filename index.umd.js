!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("quill")):"function"==typeof define&&define.amd?define(["exports","quill"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).TableUp={},t.Quill)}(this,(function(t,e){"use strict";function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function i(t,e,n,i,o,r,a){try{var l=t[r](a),s=l.value}catch(t){return void n(t)}l.done?e(s):Promise.resolve(s).then(i,o)}function o(t){return function(){var e=this,n=arguments;return new Promise((function(o,r){var a=t.apply(e,n);function l(t){i(a,o,r,l,s,"next",t)}function s(t){i(a,o,r,l,s,"throw",t)}l(void 0)}))}}function r(t,e,n){return e=h(e),g(t,p()?Reflect.construct(e,n||[],h(t).constructor):e.apply(t,n))}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,k(i.key),i)}}function s(t,e,n){return e&&l(t.prototype,e),n&&l(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function c(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=T(t))||e){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){l=!0,r=t},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw r}}}}function d(t,e,n){return(e=k(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var i=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},u.apply(null,arguments)}function h(t){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},h(t)}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&w(t,e)}function p(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(p=function(){return!!t})()}function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function b(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){d(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function m(t,e){if(null==t)return{};var n,i,o=function(t,e){if(null==t)return{};var n={};for(var i in t)if({}.hasOwnProperty.call(t,i)){if(-1!==e.indexOf(i))continue;n[i]=t[i]}return n}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(i=0;i<r.length;i++)n=r[i],-1===e.indexOf(n)&&{}.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}function g(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function y(){y=function(){return e};var t,e={},n=Object.prototype,i=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},r=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function s(t,e,n,i){return Object.defineProperty(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i})}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function c(e,n,i,o){var r=n&&n.prototype instanceof h?n:h,a=Object.create(r.prototype);return s(a,"_invoke",function(e,n,i){var o=1;return function(r,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===r)throw a;return{value:t,done:!0}}for(i.method=r,i.arg=a;;){var l=i.delegate;if(l){var s=x(l,i);if(s){if(s===u)continue;return s}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(1===o)throw o=4,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o=3;var c=d(e,n,i);if("normal"===c.type){if(o=i.done?4:2,c.arg===u)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(o=4,i.method="throw",i.arg=c.arg)}}}(e,i,new I(o||[])),!0),a}function d(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var u={};function h(){}function f(){}function p(){}var v={};s(v,r,(function(){return this}));var b=Object.getPrototypeOf,m=b&&b(b(T([])));m&&m!==n&&i.call(m,r)&&(v=m);var g=p.prototype=h.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){function n(o,r,a,l){var s=d(t[o],t,r);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"==typeof u&&i.call(u,"__await")?e.resolve(u.__await).then((function(t){n("next",t,a,l)}),(function(t){n("throw",t,a,l)})):e.resolve(u).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,l)}))}l(s.arg)}var o;s(this,"_invoke",(function(t,i){function r(){return new e((function(e,o){n(t,i,e,o)}))}return o=o?o.then(r,r):r()}),!0)}function x(e,n){var i=n.method,o=e.i[i];if(o===t)return n.delegate=null,"throw"===i&&e.i.return&&(n.method="return",n.arg=t,x(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),u;var r=d(o,e.i,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,u;var a=r.arg;return a?a.done?(n[e.r]=a.value,n.next=e.n,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,u):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,u)}function M(t){this.tryEntries.push(t)}function k(e){var n=e[4]||{};n.type="normal",n.arg=t,e[4]=n}function I(t){this.tryEntries=[[-1]],t.forEach(M,this),this.reset(!0)}function T(e){if(null!=e){var n=e[r];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function n(){for(;++o<e.length;)if(i.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(typeof e+" is not iterable")}return f.prototype=p,s(g,"constructor",p),s(p,"constructor",f),f.displayName=s(p,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,l,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},w(C.prototype),s(C.prototype,a,(function(){return this})),e.AsyncIterator=C,e.async=function(t,n,i,o,r){void 0===r&&(r=Promise);var a=new C(c(t,n,i,o),r);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(g),s(g,l,"Generator"),s(g,r,(function(){return this})),s(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var i in e)n.unshift(i);return function t(){for(;n.length;)if((i=n.pop())in e)return t.value=i,t.done=!1,t;return t.done=!0,t}},e.values=T,I.prototype={constructor:I,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(t){a.type="throw",a.arg=e,n.next=t}for(var o=n.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],a=r[4],l=this.prev,s=r[1],c=r[2];if(-1===r[0])return i("end"),!1;if(!s&&!c)throw Error("try statement without catch or finally");if(null!=r[0]&&r[0]<=l){if(l<s)return this.method="next",this.arg=t,i(s),!0;if(l<c)return i(c),!1}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i[0]>-1&&i[0]<=this.prev&&this.prev<i[2]){var o=i;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var r=o?o[4]:{};return r.type=t,r.arg=e,o?(this.method="next",this.next=o[2],u):this.complete(r)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n[2]===t)return this.complete(n[4],n[3]),k(n),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n[0]===t){var i=n[4];if("throw"===i.type){var o=i.arg;k(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={i:T(e),r:n,n:i},"next"===this.method&&(this.arg=t),u}},e}function w(t,e){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},w(t,e)}function C(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,o,r,a,l=[],s=!0,c=!1;try{if(r=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;s=!1}else for(;!(s=(i=r.call(n)).done)&&(l.push(i.value),l.length!==e);s=!0);}catch(t){c=!0,o=t}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(t,e)||T(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(t,e,n,i){var o=u(h(1&i?t.prototype:t),e,n);return 2&i&&"function"==typeof o?function(t){return o.apply(n,t)}:o}function M(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||T(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function T(t,e){if(t){if("string"==typeof t)return n(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(t,e):void 0}}var N={container:"table-up-container",tableCaption:"table-up-caption",tableWrapper:"table-up",tableMain:"table-up-main",tableColgroup:"table-up-colgroup",tableCol:"table-up-col",tableBody:"table-up-body",tableRow:"table-up-row",tableCell:"table-up-cell",tableCellInner:"table-up-cell-inner"},E={colMinWidthPre:5,colMinWidthPx:40,colDefaultWidth:100,rowMinHeightPx:36},S={AFTER_TABLE_RESIZE:"after-table-resize"},L={moduleName:"table-up"},B=[["rgb(255, 255, 255)","rgb(0, 0, 0)","rgb(72, 83, 104)","rgb(41, 114, 244)","rgb(0, 163, 245)","rgb(49, 155, 98)","rgb(222, 60, 54)","rgb(248, 136, 37)","rgb(245, 196, 0)","rgb(153, 56, 215)"],["rgb(242, 242, 242)","rgb(127, 127, 127)","rgb(243, 245, 247)","rgb(229, 239, 255)","rgb(229, 246, 255)","rgb(234, 250, 241)","rgb(254, 233, 232)","rgb(254, 243, 235)","rgb(254, 249, 227)","rgb(253, 235, 255)"],["rgb(216, 216, 216)","rgb(89, 89, 89)","rgb(197, 202, 211)","rgb(199, 220, 255)","rgb(199, 236, 255)","rgb(195, 234, 213)","rgb(255, 201, 199)","rgb(255, 220, 196)","rgb(255, 238, 173)","rgb(242, 199, 255)"],["rgb(191, 191, 191)","rgb(63, 63, 63)","rgb(128, 139, 158)","rgb(153, 190, 255)","rgb(153, 221, 255)","rgb(152, 215, 182)","rgb(255, 156, 153)","rgb(255, 186, 132)","rgb(255, 226, 112)","rgb(213, 142, 255)"],["rgb(165, 165, 165)","rgb(38, 38, 38)","rgb(53, 59, 69)","rgb(20, 80, 184)","rgb(18, 116, 165)","rgb(39, 124, 79)","rgb(158, 30, 26)","rgb(184, 96, 20)","rgb(163, 130, 0)","rgb(94, 34, 129)"],["rgb(147, 147, 147)","rgb(13, 13, 13)","rgb(36, 39, 46)","rgb(12, 48, 110)","rgb(10, 65, 92)","rgb(24, 78, 50)","rgb(88, 17, 14)","rgb(92, 48, 10)","rgb(102, 82, 0)","rgb(59, 21, 81)"]],R="table-up",O=new Set([N.tableCellInner]);function A(t){return!(!t||!t.parent)&&(e=t.parent,!!O.has(e.statics.blotName)||A(t.parent));var e}function z(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R,n=e?"".concat(e,"-"):"";return{b:function(){return"".concat(n).concat(t)},be:function(e){return e?"".concat(n).concat(t,"__").concat(e):""},bm:function(e){return e?"".concat(n).concat(t,"--").concat(e):""},bem:function(e,i){return e&&i?"".concat(n).concat(t,"__").concat(e,"--").concat(i):""},ns:function(t){return t?"".concat(n).concat(t):""},bs:function(e){return e?"".concat(n).concat(t,"-").concat(e):""},cv:function(t){return t?"--".concat(n).concat(t):""},is:function(t){return"is-".concat(t)}}}function q(t,e){for(var n=t.parent;n&&n.statics.blotName!==e&&n!==t.scroll;)n=n.parent;if(n===t.scroll)throw new Error("".concat(t.statics.blotName," must be a child of ").concat(e));return n}function W(t,e){for(var n=new Array(e.length),i=new Map(e.map((function(t,e){return[t,e]}))),o=t.parent;o&&o!==t.scroll&&0!==i.size;){i.has(o.statics.blotName)&&(n[i.get(o.statics.blotName)]=o,i.delete(o.statics.blotName)),o=o.parent}if(i.size>0)throw new Error("".concat(t.statics.blotName," must be a child of ").concat(Array.from(i.keys()).join(", ")));return n}function H(t){for(var e=new Map,n=t;n&&"scroll"!==n.statics.blotName;)e.set(n.statics.blotName,n),n=n.parent;return e}function D(t,e){for(var n=[],i=t.children.iterator(),o=null;o=i();)o instanceof e&&n.push(o);return n}function j(t,e){var n,i=c(Object.getOwnPropertyNames(e));try{for(i.s();!(n=i.n()).done;){var o=n.value;/^constructor$/.test(o)||Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(e,o))}}catch(t){i.e(t)}finally{i.f()}return t}function P(t,e){return t=Math.min(e,Math.max(0,Number.parseFloat("".concat(t)))),Math.abs(t-e)<1e-6?1:t%e/Number.parseFloat(e)}function F(t){return{h:Math.min(360,Math.max(0,t.h)),s:Math.min(100,Math.max(0,t.s)),b:Math.min(100,Math.max(0,t.b)),a:Math.min(1,Math.max(0,t.a))}}function _(t){var e=t.r,n=t.g,i=t.b,o=t.a;e=P(e,255),n=P(n,255),i=P(i,255);var r,a=Math.max(e,n,i),l=Math.min(e,n,i),s=a,c=a-l,d=0===a?0:c/a;if(a===l)r=0;else{switch(a){case e:r=(n-i)/c+(n<i?6:0);break;case n:r=(i-e)/c+2;break;case i:r=(e-n)/c+4}r/=6}return{h:360*r,s:100*d,b:100*s,a:o}}function V(t){var e=t.h,n=t.s,i=t.b,o=t.a;e=6*P(e,360),n=P(n,100),i=P(i,100);var r=Math.floor(e),a=e-r,l=i*(1-n),s=i*(1-a*n),c=i*(1-(1-a)*n),d=r%6,u=[i,s,l,l,c,i][d],h=[c,i,i,s,l,l][d],f=[l,l,c,i,i,s][d];return{r:Math.round(255*u),g:Math.round(255*h),b:Math.round(255*f),a:o}}function X(t){var e=[t.r.toString(16),t.g.toString(16),t.b.toString(16),Math.round(255*t.a).toString(16)];for(var n in e)1===e[n].length&&(e[n]="0".concat(e[n]));return e.join("")}var U=function(t){return X(V(t))},Y=function(t){return"function"==typeof t},G=Array.isArray,K=function(t){return"string"==typeof t},Z=function(t){return null!==t&&"object"===I(t)};function $(t){var e=t||{},n=e.type,i=void 0===n?"default":n,o=e.content,r=z("button"),a=document.createElement("button");return a.classList.add(r.b(),i),o&&(K(o)?a.textContent=o:a.appendChild(o)),a}function Q(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=230,i=150,o=10,r=_((t=(t=e.color||"#ff0000").startsWith("#")?t.slice(1):t,{r:Number.parseInt(t.slice(0,2),16),g:Number.parseInt(t.slice(2,4),16),b:Number.parseInt(t.slice(4,6),16),a:Number((Number.parseInt(t.slice(6,8)||"ff",16)/255).toFixed(2))})),a=z("color-picker"),l=document.createElement("div");l.classList.add(a.b());var s=document.createElement("div");s.classList.add(a.be("content"));var u=document.createElement("div");u.classList.add(a.be("selector"));var h=document.createElement("div");h.classList.add(a.be("background")),u.appendChild(h);var f=document.createElement("div");f.classList.add(a.be("background-handle")),h.appendChild(f);var p=document.createElement("div");p.classList.add(a.be("alpha"));var v=document.createElement("div");v.classList.add(a.be("alpha-bg"));var b=document.createElement("div");b.classList.add(a.be("alpha-handle")),p.appendChild(v),p.appendChild(b);var m=document.createElement("div");m.classList.add(a.be("hue"));var g=document.createElement("div");g.classList.add(a.be("hue-handle")),m.appendChild(g);var y=document.createElement("div");y.classList.add(a.be("action"));var w=C(["r","g","b","a"].map((function(t){var e=document.createElement("div");e.classList.add(a.be("action-item"),t);var n=document.createElement("label");n.textContent=t.toUpperCase();var i=document.createElement("input");return i.classList.add(a.be("input")),i.addEventListener("input",(function(){i.value=i.value.replaceAll(/[^0-9]/g,"")})),i.addEventListener("change",(function(){var e=Math.round(Number(i.value));"a"===t&&(e/=100),B(F(_(Object.assign({},V(r),d({},t,e))))),L()})),e.appendChild(n),e.appendChild(i),y.appendChild(e),i})),4),x=w[0],M=w[1],k=w[2],I=w[3];s.appendChild(m),s.appendChild(u),s.appendChild(p),l.appendChild(s),l.appendChild(y);var T=!1,N=!1,E=!1;function S(){var t,e=U(r),n=c([x,M,k].entries());try{for(n.s();!(t=n.n()).done;){var i=C(t.value,2),o=i[0];i[1].value=String(Number.parseInt(e[2*o]+e[2*o+1],16))}}catch(t){n.e(t)}finally{n.f()}I.value=String((100*r.a).toFixed(0))}function L(){var t,e,o,a;Object.assign(f.style,{left:"".concat(Math.floor(n*r.s/100),"px"),top:"".concat(Math.floor(i*(100-r.b)/100),"px")}),u.style.backgroundColor="#".concat(X(V({h:r.h,s:100,b:100,a:1}))),g.style.top="".concat(Math.floor(i-i*r.h/360),"px"),b.style.left="".concat(100*r.a,"%"),t=V(r),e=t.r,o=t.g,a=t.b,v.style.background="linear-gradient(to right, rgba(".concat(e,", ").concat(o,", ").concat(a,", 0) 0%, rgba(").concat(e,", ").concat(o,", ").concat(a,", 1) 100%)"),S()}function B(t){r=F(Object.assign({},r,t)),S(),e.onChange&&e.onChange("#".concat(U(r)))}function R(t){var e=u.getBoundingClientRect(),o=e.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),r=e.left+document.body.scrollLeft;B({s:Math.floor(100*Math.max(0,Math.min(n,t.pageX-r))/n),b:Math.floor(100*(i-Math.max(0,Math.min(i,t.pageY-o)))/i)}),L()}function O(t){var e=m.getBoundingClientRect().top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0);B({h:Math.floor(360*(i-Math.max(0,Math.min(i,t.pageY-e)))/i)}),L()}function A(t){var e=t.pageX,n=p.getBoundingClientRect(),i=e-n.left;i=Math.max(o/2,i),i=Math.min(i,n.width-o/2),B({a:Math.round((i-5)/(n.width-10)*100)/100}),L()}function q(t){T&&(t.preventDefault(),R(t)),N&&(t.preventDefault(),O(t)),E&&(t.preventDefault(),A(t))}function W(){document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",W),T=!1}function H(){document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",H),N=!1}function D(){document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",D),E=!1}return u.addEventListener("mousedown",(function(t){document.addEventListener("mousemove",q),document.addEventListener("mouseup",W),T=!0,R(t)})),m.addEventListener("mousedown",(function(t){document.addEventListener("mousemove",q),document.addEventListener("mouseup",H),N=!0,O(t)})),p.addEventListener("mousedown",(function(t){document.addEventListener("mousemove",q),document.addEventListener("mouseup",D),E=!0,A(t)})),L(),l}var J=8e3;function tt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.child,n=t.target,i=void 0===n?document.body:n,o=t.beforeClose,r=void 0===o?function(){}:o,a=z("dialog"),l=i,s=document.createElement("div");s.classList.add(a.b()),s.style.zIndex=String(J);var c=document.createElement("div");if(c.classList.add(a.be("overlay")),s.appendChild(c),e){var d=document.createElement("div");d.classList.add(a.be("content")),d.appendChild(e),c.appendChild(d),d.addEventListener("click",(function(t){t.stopPropagation()}))}var u=getComputedStyle(l).overflow;l.style.overflow="hidden",l.appendChild(s);var h=function(){r(),s.remove(),l.style.overflow=u};return s.addEventListener("click",h),J+=1,{dialog:s,close:h}}function et(t,e){var n=z("input");e.type||(e.type="text"),e.value||(e.value="");var i=document.createElement("div");if(i.classList.add(n.be("item")),t){var o=document.createElement("span");o.classList.add(n.be("label")),o.textContent=t,i.appendChild(o)}var r=document.createElement("div");r.classList.add(n.be("input"));var a=document.createElement("input");for(var l in e)a.setAttribute(l,e[l]);(e.max||e.min)&&a.addEventListener("blur",(function(){e.max&&e.max<=Number(a.value)&&(a.value=String(e.max)),e.min&&e.min>=Number(a.value)&&(a.value=String(e.min))})),r.appendChild(a),i.appendChild(r),a.addEventListener("focus",(function(){r.classList.add("focus")})),a.addEventListener("blur",(function(){r.classList.remove("focus")}));return{item:i,input:a,errorTip:function(t){var e;r.classList.contains("error")?e=r.querySelector(".".concat(n.be("error-tip"))):(e=document.createElement("span"),e.classList.add(n.be("error-tip")),r.appendChild(e)),e.textContent=t,r.classList.add("error");return{removeError:function(){r.classList.remove("error"),e.remove()}}}}}function nt(){return it.apply(this,arguments)}function it(){return it=o(y().mark((function t(){var e,n,i,r,a,l,s,c,d,u,h,f,p,v,b,m,g,w=arguments;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=w.length>0&&void 0!==w[0]?w[0]:{},n=z("creator"),(i=document.createElement("div")).classList.add(n.b()),(r=document.createElement("div")).classList.add(n.be("input")),a=et(e.rowText||"Row",{type:"number",value:String(e.row||""),max:99}),l=a.item,s=a.input,c=a.errorTip,d=et(e.colText||"Column",{type:"number",value:String(e.col||""),max:99}),u=d.item,h=d.input,f=d.errorTip,r.appendChild(l),r.appendChild(u),i.appendChild(r),(p=document.createElement("div")).classList.add(n.be("control")),v=$({type:"confirm",content:e.confirmText||"Confirm"}),b=$({type:"default",content:e.cancelText||"Cancel"}),p.appendChild(v),p.appendChild(b),i.appendChild(p),m=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number(s.value),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number(h.value);if(Number.isNaN(t)||t<=0)c(e.notPositiveNumberError||"Please enter a positive integer");else{if(!(Number.isNaN(n)||n<=0))return{row:t,col:n};f(e.notPositiveNumberError||"Please enter a positive integer")}},g=function(t){"Escape"===t.key&&(close(),document.removeEventListener("keydown",g))},t.abrupt("return",new Promise((function(t,e){var n=tt({child:i,beforeClose:e}).close;s.focus();for(var r=0,a=[s,h];r<a.length;r++){a[r].addEventListener("keydown",(function(e){if("Enter"===e.key){var i=m();i&&(t(i),n())}}))}v.addEventListener("click",o(y().mark((function e(){var i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(i=m())&&(t(i),n());case 2:case"end":return e.stop()}}),e)})))),document.addEventListener("keydown",g),b.addEventListener("click",n)})));case 21:case"end":return t.stop()}}),t)}))),it.apply(this,arguments)}function ot(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=z("select-box"),n=document.createElement("div");n.classList.add(e.b());var i=document.createElement("div");i.classList.add(e.be("block"));for(var r=0;r<(t.row||8);r++)for(var a=0;a<(t.col||8);a++){var l=document.createElement("div");l.classList.add(e.be("item")),l.dataset.row=String(r+1),l.dataset.col=String(a+1),i.appendChild(l)}var s=function(){for(var t=n.dataset,e=t.row,o=t.col,r=0,a=Array.from(i.querySelectorAll(".active"));r<a.length;r++){a[r].classList.remove("active")}if(e&&o)for(var l=Array.from(i.children),s=0;s<l.length;s++){var c=l[s].dataset,d=c.row,u=c.col;if(d>e&&u>o)return;d<=e&&u<=o?l[s].classList.add("active"):l[s].classList.remove("active")}};if(i.addEventListener("mousemove",(function(t){if(t.target){var e=t.target.dataset,i=e.row,o=e.col;i&&o&&(n.dataset.row=i,n.dataset.col=o,s())}})),i.addEventListener("mouseleave",(function(){n.removeAttribute("data-row"),n.removeAttribute("data-col"),s()})),i.addEventListener("click",(function(){var e=n.dataset,i=e.row,o=e.col;i&&o&&t.onSelect&&t.onSelect(Number(i),Number(o))})),n.appendChild(i),t.customBtn){var c=t.texts||{},d=document.createElement("div");d.classList.add(e.be("custom")),d.textContent=c.customBtnText||"Custom",d.addEventListener("click",o(y().mark((function e(){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt(c);case 2:(n=e.sent)&&t.onSelect&&t.onSelect(n.row,n.col);case 4:case"end":return e.stop()}}),e)})))),n.appendChild(d)}return n}const rt=Math.min,at=Math.max,lt=Math.round,st=Math.floor,ct=t=>({x:t,y:t}),dt={left:"right",right:"left",bottom:"top",top:"bottom"},ut={start:"end",end:"start"};function ht(t,e,n){return at(t,rt(e,n))}function ft(t,e){return"function"==typeof t?t(e):t}function pt(t){return t.split("-")[0]}function vt(t){return t.split("-")[1]}function bt(t){return"x"===t?"y":"x"}function mt(t){return"y"===t?"height":"width"}function gt(t){return["top","bottom"].includes(pt(t))?"y":"x"}function yt(t){return bt(gt(t))}function wt(t){return t.replace(/start|end/g,(t=>ut[t]))}function Ct(t){return t.replace(/left|right|bottom|top/g,(t=>dt[t]))}function xt(t){const{x:e,y:n,width:i,height:o}=t;return{width:i,height:o,top:n,left:e,right:e+i,bottom:n+o,x:e,y:n}}function Mt(t,e,n){let{reference:i,floating:o}=t;const r=gt(e),a=yt(e),l=mt(a),s=pt(e),c="y"===r,d=i.x+i.width/2-o.width/2,u=i.y+i.height/2-o.height/2,h=i[l]/2-o[l]/2;let f;switch(s){case"top":f={x:d,y:i.y-o.height};break;case"bottom":f={x:d,y:i.y+i.height};break;case"right":f={x:i.x+i.width,y:u};break;case"left":f={x:i.x-o.width,y:u};break;default:f={x:i.x,y:i.y}}switch(vt(e)){case"start":f[a]-=h*(n&&c?-1:1);break;case"end":f[a]+=h*(n&&c?-1:1)}return f}async function kt(t,e){var n;void 0===e&&(e={});const{x:i,y:o,platform:r,rects:a,elements:l,strategy:s}=t,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:h=!1,padding:f=0}=ft(e,t),p=function(t){return"number"!=typeof t?function(t){return{top:0,right:0,bottom:0,left:0,...t}}(t):{top:t,right:t,bottom:t,left:t}}(f),v=l[h?"floating"===u?"reference":"floating":u],b=xt(await r.getClippingRect({element:null==(n=await(null==r.isElement?void 0:r.isElement(v)))||n?v:v.contextElement||await(null==r.getDocumentElement?void 0:r.getDocumentElement(l.floating)),boundary:c,rootBoundary:d,strategy:s})),m="floating"===u?{x:i,y:o,width:a.floating.width,height:a.floating.height}:a.reference,g=await(null==r.getOffsetParent?void 0:r.getOffsetParent(l.floating)),y=await(null==r.isElement?void 0:r.isElement(g))&&await(null==r.getScale?void 0:r.getScale(g))||{x:1,y:1},w=xt(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:m,offsetParent:g,strategy:s}):m);return{top:(b.top-w.top+p.top)/y.y,bottom:(w.bottom-b.bottom+p.bottom)/y.y,left:(b.left-w.left+p.left)/y.x,right:(w.right-b.right+p.right)/y.x}}function It(){return"undefined"!=typeof window}function Tt(t){return St(t)?(t.nodeName||"").toLowerCase():"#document"}function Nt(t){var e;return(null==t||null==(e=t.ownerDocument)?void 0:e.defaultView)||window}function Et(t){var e;return null==(e=(St(t)?t.ownerDocument:t.document)||window.document)?void 0:e.documentElement}function St(t){return!!It()&&(t instanceof Node||t instanceof Nt(t).Node)}function Lt(t){return!!It()&&(t instanceof Element||t instanceof Nt(t).Element)}function Bt(t){return!!It()&&(t instanceof HTMLElement||t instanceof Nt(t).HTMLElement)}function Rt(t){return!(!It()||"undefined"==typeof ShadowRoot)&&(t instanceof ShadowRoot||t instanceof Nt(t).ShadowRoot)}function Ot(t){const{overflow:e,overflowX:n,overflowY:i,display:o}=Dt(t);return/auto|scroll|overlay|hidden|clip/.test(e+i+n)&&!["inline","contents"].includes(o)}function At(t){return["table","td","th"].includes(Tt(t))}function zt(t){return[":popover-open",":modal"].some((e=>{try{return t.matches(e)}catch(t){return!1}}))}function qt(t){const e=Wt(),n=Lt(t)?Dt(t):t;return["transform","translate","scale","rotate","perspective"].some((t=>!!n[t]&&"none"!==n[t]))||!!n.containerType&&"normal"!==n.containerType||!e&&!!n.backdropFilter&&"none"!==n.backdropFilter||!e&&!!n.filter&&"none"!==n.filter||["transform","translate","scale","rotate","perspective","filter"].some((t=>(n.willChange||"").includes(t)))||["paint","layout","strict","content"].some((t=>(n.contain||"").includes(t)))}function Wt(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function Ht(t){return["html","body","#document"].includes(Tt(t))}function Dt(t){return Nt(t).getComputedStyle(t)}function jt(t){return Lt(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Pt(t){if("html"===Tt(t))return t;const e=t.assignedSlot||t.parentNode||Rt(t)&&t.host||Et(t);return Rt(e)?e.host:e}function Ft(t){const e=Pt(t);return Ht(e)?t.ownerDocument?t.ownerDocument.body:t.body:Bt(e)&&Ot(e)?e:Ft(e)}function _t(t,e,n){var i;void 0===e&&(e=[]),void 0===n&&(n=!0);const o=Ft(t),r=o===(null==(i=t.ownerDocument)?void 0:i.body),a=Nt(o);if(r){const t=Vt(a);return e.concat(a,a.visualViewport||[],Ot(o)?o:[],t&&n?_t(t):[])}return e.concat(o,_t(o,[],n))}function Vt(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Xt(t){const e=Dt(t);let n=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const o=Bt(t),r=o?t.offsetWidth:n,a=o?t.offsetHeight:i,l=lt(n)!==r||lt(i)!==a;return l&&(n=r,i=a),{width:n,height:i,$:l}}function Ut(t){return Lt(t)?t:t.contextElement}function Yt(t){const e=Ut(t);if(!Bt(e))return ct(1);const n=e.getBoundingClientRect(),{width:i,height:o,$:r}=Xt(e);let a=(r?lt(n.width):n.width)/i,l=(r?lt(n.height):n.height)/o;return a&&Number.isFinite(a)||(a=1),l&&Number.isFinite(l)||(l=1),{x:a,y:l}}const Gt=ct(0);function Kt(t){const e=Nt(t);return Wt()&&e.visualViewport?{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}:Gt}function Zt(t,e,n,i){void 0===e&&(e=!1),void 0===n&&(n=!1);const o=t.getBoundingClientRect(),r=Ut(t);let a=ct(1);e&&(i?Lt(i)&&(a=Yt(i)):a=Yt(t));const l=function(t,e,n){return void 0===e&&(e=!1),!(!n||e&&n!==Nt(t))&&e}(r,n,i)?Kt(r):ct(0);let s=(o.left+l.x)/a.x,c=(o.top+l.y)/a.y,d=o.width/a.x,u=o.height/a.y;if(r){const t=Nt(r),e=i&&Lt(i)?Nt(i):i;let n=t,o=Vt(n);for(;o&&i&&e!==n;){const t=Yt(o),e=o.getBoundingClientRect(),i=Dt(o),r=e.left+(o.clientLeft+parseFloat(i.paddingLeft))*t.x,a=e.top+(o.clientTop+parseFloat(i.paddingTop))*t.y;s*=t.x,c*=t.y,d*=t.x,u*=t.y,s+=r,c+=a,n=Nt(o),o=Vt(n)}}return xt({width:d,height:u,x:s,y:c})}function $t(t,e){const n=jt(t).scrollLeft;return e?e.left+n:Zt(Et(t)).left+n}function Qt(t,e,n){void 0===n&&(n=!1);const i=t.getBoundingClientRect();return{x:i.left+e.scrollLeft-(n?0:$t(t,i)),y:i.top+e.scrollTop}}function Jt(t,e,n){let i;if("viewport"===e)i=function(t,e){const n=Nt(t),i=Et(t),o=n.visualViewport;let r=i.clientWidth,a=i.clientHeight,l=0,s=0;if(o){r=o.width,a=o.height;const t=Wt();(!t||t&&"fixed"===e)&&(l=o.offsetLeft,s=o.offsetTop)}return{width:r,height:a,x:l,y:s}}(t,n);else if("document"===e)i=function(t){const e=Et(t),n=jt(t),i=t.ownerDocument.body,o=at(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),r=at(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let a=-n.scrollLeft+$t(t);const l=-n.scrollTop;return"rtl"===Dt(i).direction&&(a+=at(e.clientWidth,i.clientWidth)-o),{width:o,height:r,x:a,y:l}}(Et(t));else if(Lt(e))i=function(t,e){const n=Zt(t,!0,"fixed"===e),i=n.top+t.clientTop,o=n.left+t.clientLeft,r=Bt(t)?Yt(t):ct(1);return{width:t.clientWidth*r.x,height:t.clientHeight*r.y,x:o*r.x,y:i*r.y}}(e,n);else{const n=Kt(t);i={x:e.x-n.x,y:e.y-n.y,width:e.width,height:e.height}}return xt(i)}function te(t,e){const n=Pt(t);return!(n===e||!Lt(n)||Ht(n))&&("fixed"===Dt(n).position||te(n,e))}function ee(t,e,n){const i=Bt(e),o=Et(e),r="fixed"===n,a=Zt(t,!0,r,e);let l={scrollLeft:0,scrollTop:0};const s=ct(0);if(i||!i&&!r)if(("body"!==Tt(e)||Ot(o))&&(l=jt(e)),i){const t=Zt(e,!0,r,e);s.x=t.x+e.clientLeft,s.y=t.y+e.clientTop}else o&&(s.x=$t(o));const c=!o||i||r?ct(0):Qt(o,l);return{x:a.left+l.scrollLeft-s.x-c.x,y:a.top+l.scrollTop-s.y-c.y,width:a.width,height:a.height}}function ne(t){return"static"===Dt(t).position}function ie(t,e){if(!Bt(t)||"fixed"===Dt(t).position)return null;if(e)return e(t);let n=t.offsetParent;return Et(t)===n&&(n=n.ownerDocument.body),n}function oe(t,e){const n=Nt(t);if(zt(t))return n;if(!Bt(t)){let e=Pt(t);for(;e&&!Ht(e);){if(Lt(e)&&!ne(e))return e;e=Pt(e)}return n}let i=ie(t,e);for(;i&&At(i)&&ne(i);)i=ie(i,e);return i&&Ht(i)&&ne(i)&&!qt(i)?n:i||function(t){let e=Pt(t);for(;Bt(e)&&!Ht(e);){if(qt(e))return e;if(zt(e))return null;e=Pt(e)}return null}(t)||n}const re={convertOffsetParentRelativeRectToViewportRelativeRect:function(t){let{elements:e,rect:n,offsetParent:i,strategy:o}=t;const r="fixed"===o,a=Et(i),l=!!e&&zt(e.floating);if(i===a||l&&r)return n;let s={scrollLeft:0,scrollTop:0},c=ct(1);const d=ct(0),u=Bt(i);if((u||!u&&!r)&&(("body"!==Tt(i)||Ot(a))&&(s=jt(i)),Bt(i))){const t=Zt(i);c=Yt(i),d.x=t.x+i.clientLeft,d.y=t.y+i.clientTop}const h=!a||u||r?ct(0):Qt(a,s,!0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-s.scrollLeft*c.x+d.x+h.x,y:n.y*c.y-s.scrollTop*c.y+d.y+h.y}},getDocumentElement:Et,getClippingRect:function(t){let{element:e,boundary:n,rootBoundary:i,strategy:o}=t;const r=[..."clippingAncestors"===n?zt(e)?[]:function(t,e){const n=e.get(t);if(n)return n;let i=_t(t,[],!1).filter((t=>Lt(t)&&"body"!==Tt(t))),o=null;const r="fixed"===Dt(t).position;let a=r?Pt(t):t;for(;Lt(a)&&!Ht(a);){const e=Dt(a),n=qt(a);n||"fixed"!==e.position||(o=null),(r?!n&&!o:!n&&"static"===e.position&&o&&["absolute","fixed"].includes(o.position)||Ot(a)&&!n&&te(t,a))?i=i.filter((t=>t!==a)):o=e,a=Pt(a)}return e.set(t,i),i}(e,this._c):[].concat(n),i],a=r[0],l=r.reduce(((t,n)=>{const i=Jt(e,n,o);return t.top=at(i.top,t.top),t.right=rt(i.right,t.right),t.bottom=rt(i.bottom,t.bottom),t.left=at(i.left,t.left),t}),Jt(e,a,o));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}},getOffsetParent:oe,getElementRects:async function(t){const e=this.getOffsetParent||oe,n=this.getDimensions,i=await n(t.floating);return{reference:ee(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}},getClientRects:function(t){return Array.from(t.getClientRects())},getDimensions:function(t){const{width:e,height:n}=Xt(t);return{width:e,height:n}},getScale:Yt,isElement:Lt,isRTL:function(t){return"rtl"===Dt(t).direction}};function ae(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function le(t,e,n,i){void 0===i&&(i={});const{ancestorScroll:o=!0,ancestorResize:r=!0,elementResize:a="function"==typeof ResizeObserver,layoutShift:l="function"==typeof IntersectionObserver,animationFrame:s=!1}=i,c=Ut(t),d=o||r?[...c?_t(c):[],..._t(e)]:[];d.forEach((t=>{o&&t.addEventListener("scroll",n,{passive:!0}),r&&t.addEventListener("resize",n)}));const u=c&&l?function(t,e){let n,i=null;const o=Et(t);function r(){var t;clearTimeout(n),null==(t=i)||t.disconnect(),i=null}return function a(l,s){void 0===l&&(l=!1),void 0===s&&(s=1),r();const c=t.getBoundingClientRect(),{left:d,top:u,width:h,height:f}=c;if(l||e(),!h||!f)return;const p={rootMargin:-st(u)+"px "+-st(o.clientWidth-(d+h))+"px "+-st(o.clientHeight-(u+f))+"px "+-st(d)+"px",threshold:at(0,rt(1,s))||1};let v=!0;function b(e){const i=e[0].intersectionRatio;if(i!==s){if(!v)return a();i?a(!1,i):n=setTimeout((()=>{a(!1,1e-7)}),1e3)}1!==i||ae(c,t.getBoundingClientRect())||a(),v=!1}try{i=new IntersectionObserver(b,{...p,root:o.ownerDocument})}catch(t){i=new IntersectionObserver(b,p)}i.observe(t)}(!0),r}(c,n):null;let h,f=-1,p=null;a&&(p=new ResizeObserver((t=>{let[i]=t;i&&i.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame((()=>{var t;null==(t=p)||t.observe(e)}))),n()})),c&&!s&&p.observe(c),p.observe(e));let v=s?Zt(t):null;return s&&function e(){const i=Zt(t);v&&!ae(v,i)&&n();v=i,h=requestAnimationFrame(e)}(),n(),()=>{var t;d.forEach((t=>{o&&t.removeEventListener("scroll",n),r&&t.removeEventListener("resize",n)})),null==u||u(),null==(t=p)||t.disconnect(),p=null,s&&cancelAnimationFrame(h)}}const se=function(t){return void 0===t&&(t=0),{name:"offset",options:t,async fn(e){var n,i;const{x:o,y:r,placement:a,middlewareData:l}=e,s=await async function(t,e){const{placement:n,platform:i,elements:o}=t,r=await(null==i.isRTL?void 0:i.isRTL(o.floating)),a=pt(n),l=vt(n),s="y"===gt(n),c=["left","top"].includes(a)?-1:1,d=r&&s?-1:1,u=ft(e,t);let{mainAxis:h,crossAxis:f,alignmentAxis:p}="number"==typeof u?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return l&&"number"==typeof p&&(f="end"===l?-1*p:p),s?{x:f*d,y:h*c}:{x:h*c,y:f*d}}(e,t);return a===(null==(n=l.offset)?void 0:n.placement)&&null!=(i=l.arrow)&&i.alignmentOffset?{}:{x:o+s.x,y:r+s.y,data:{...s,placement:a}}}}},ce=function(t){return void 0===t&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:i,placement:o}=e,{mainAxis:r=!0,crossAxis:a=!1,limiter:l={fn:t=>{let{x:e,y:n}=t;return{x:e,y:n}}},...s}=ft(t,e),c={x:n,y:i},d=await kt(e,s),u=gt(pt(o)),h=bt(u);let f=c[h],p=c[u];if(r){const t="y"===h?"bottom":"right";f=ht(f+d["y"===h?"top":"left"],f,f-d[t])}if(a){const t="y"===u?"bottom":"right";p=ht(p+d["y"===u?"top":"left"],p,p-d[t])}const v=l.fn({...e,[h]:f,[u]:p});return{...v,data:{x:v.x-n,y:v.y-i,enabled:{[h]:r,[u]:a}}}}}},de=function(t){return void 0===t&&(t={}),{name:"flip",options:t,async fn(e){var n,i;const{placement:o,middlewareData:r,rects:a,initialPlacement:l,platform:s,elements:c}=e,{mainAxis:d=!0,crossAxis:u=!0,fallbackPlacements:h,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:v=!0,...b}=ft(t,e);if(null!=(n=r.arrow)&&n.alignmentOffset)return{};const m=pt(o),g=gt(l),y=pt(l)===l,w=await(null==s.isRTL?void 0:s.isRTL(c.floating)),C=h||(y||!v?[Ct(l)]:function(t){const e=Ct(t);return[wt(t),e,wt(e)]}(l)),x="none"!==p;!h&&x&&C.push(...function(t,e,n,i){const o=vt(t);let r=function(t,e,n){const i=["left","right"],o=["right","left"],r=["top","bottom"],a=["bottom","top"];switch(t){case"top":case"bottom":return n?e?o:i:e?i:o;case"left":case"right":return e?r:a;default:return[]}}(pt(t),"start"===n,i);return o&&(r=r.map((t=>t+"-"+o)),e&&(r=r.concat(r.map(wt)))),r}(l,v,p,w));const M=[l,...C],k=await kt(e,b),I=[];let T=(null==(i=r.flip)?void 0:i.overflows)||[];if(d&&I.push(k[m]),u){const t=function(t,e,n){void 0===n&&(n=!1);const i=vt(t),o=yt(t),r=mt(o);let a="x"===o?i===(n?"end":"start")?"right":"left":"start"===i?"bottom":"top";return e.reference[r]>e.floating[r]&&(a=Ct(a)),[a,Ct(a)]}(o,a,w);I.push(k[t[0]],k[t[1]])}if(T=[...T,{placement:o,overflows:I}],!I.every((t=>t<=0))){var N,E;const t=((null==(N=r.flip)?void 0:N.index)||0)+1,e=M[t];if(e)return{data:{index:t,overflows:T},reset:{placement:e}};let n=null==(E=T.filter((t=>t.overflows[0]<=0)).sort(((t,e)=>t.overflows[1]-e.overflows[1]))[0])?void 0:E.placement;if(!n)switch(f){case"bestFit":{var S;const t=null==(S=T.filter((t=>{if(x){const e=gt(t.placement);return e===g||"y"===e}return!0})).map((t=>[t.placement,t.overflows.filter((t=>t>0)).reduce(((t,e)=>t+e),0)])).sort(((t,e)=>t[1]-e[1]))[0])?void 0:S[0];t&&(n=t);break}case"initialPlacement":n=l}if(o!==n)return{reset:{placement:n}}}return{}}}},ue=function(t){return void 0===t&&(t={}),{options:t,fn(e){const{x:n,y:i,placement:o,rects:r,middlewareData:a}=e,{offset:l=0,mainAxis:s=!0,crossAxis:c=!0}=ft(t,e),d={x:n,y:i},u=gt(o),h=bt(u);let f=d[h],p=d[u];const v=ft(l,e),b="number"==typeof v?{mainAxis:v,crossAxis:0}:{mainAxis:0,crossAxis:0,...v};if(s){const t="y"===h?"height":"width",e=r.reference[h]-r.floating[t]+b.mainAxis,n=r.reference[h]+r.reference[t]-b.mainAxis;f<e?f=e:f>n&&(f=n)}if(c){var m,g;const t="y"===h?"width":"height",e=["top","left"].includes(pt(o)),n=r.reference[u]-r.floating[t]+(e&&(null==(m=a.offset)?void 0:m[u])||0)+(e?0:b.crossAxis),i=r.reference[u]+r.reference[t]+(e?0:(null==(g=a.offset)?void 0:g[u])||0)-(e?b.crossAxis:0);p<n?p=n:p>i&&(p=i)}return{[h]:f,[u]:p}}}},he=(t,e,n)=>{const i=new Map,o={platform:re,...n},r={...o.platform,_c:i};return(async(t,e,n)=>{const{placement:i="bottom",strategy:o="absolute",middleware:r=[],platform:a}=n,l=r.filter(Boolean),s=await(null==a.isRTL?void 0:a.isRTL(e));let c=await a.getElementRects({reference:t,floating:e,strategy:o}),{x:d,y:u}=Mt(c,i,s),h=i,f={},p=0;for(let n=0;n<l.length;n++){const{name:r,fn:v}=l[n],{x:b,y:m,data:g,reset:y}=await v({x:d,y:u,initialPlacement:i,placement:h,strategy:o,middlewareData:f,rects:c,platform:a,elements:{reference:t,floating:e}});d=null!=b?b:d,u=null!=m?m:u,f={...f,[r]:{...f[r],...g}},y&&p<=50&&(p++,"object"==typeof y&&(y.placement&&(h=y.placement),y.rects&&(c=!0===y.rects?await a.getElementRects({reference:t,floating:e,strategy:o}):y.rects),({x:d,y:u}=Mt(c,h,s))),n=-1)}return{x:d,y:u,placement:h,strategy:o,middlewareData:f}})(t,e,{...o,platform:r})};var fe;function pe(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.msg,i=void 0===n?"":n,o=e.delay,r=void 0===o?150:o,a=e.content,l=e.direction,s=void 0===l?"bottom":l,c=e.type,d=void 0===c?"hover":c,u=e.container,h=e.onOpen,f=e.onClose,p=e.closed,v=e.onDestroy,b=z("tooltip");if(i||a){fe||(fe=document.createElement("div"),document.body.appendChild(fe));var m,g,y,w=u||fe,C=document.createElement("div");C.classList.add(b.b(),"hidden","transparent"),a?C.appendChild(a):i&&(C.textContent=i);var x=function(){y&&y(),he(t,C,{placement:s,middleware:[de(),ce({limiter:ue()}),se(4)]}).then((function(t){var e=t.x,n=t.y;Object.assign(C.style,{left:"".concat(e,"px"),top:"".concat(n,"px")})}))},M=function(){C.classList.add("hidden"),w.contains(C)&&w.removeChild(C),y&&y(),p&&p()},k=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];g&&clearTimeout(g),m=setTimeout((function(){if(h){var n=h(e);if(!e&&n)return}w.appendChild(C),C.removeEventListener("transitionend",M),C.classList.remove("hidden"),y=le(t,C,x),C.classList.remove("transparent")}),r)},I=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];m&&clearTimeout(m),g=setTimeout((function(){if(f){var e=f(t);if(!t&&e)return}!function(t,e,n,i,o){t.addEventListener("transitionend",n,i),setTimeout((function(){n()}),e)}(C,150,M,{once:!0}),C.classList.add("transparent")}),r)},T={hover:function(){var e=[t,C],n=I.bind(void 0,!1),i=k.bind(void 0,!1);return{prepare:function(){for(var t=0,o=e;t<o.length;t++){var r=o[t];r.addEventListener("mouseenter",i),r.addEventListener("mouseleave",n)}},show:k,hide:I,destroy:function(){for(var t=0,o=e;t<o.length;t++){var r=o[t];r.removeEventListener("mouseenter",i),r.removeEventListener("mouseleave",n)}}}},click:function(){var e=function(t){t.stopPropagation(),I(!1)},n=function(t){t.stopPropagation(),k(),document.removeEventListener("click",e),document.addEventListener("click",e,{once:!0})};return{prepare:function(){C.addEventListener("click",(function(t){return t.stopPropagation()})),t.addEventListener("click",n)},show:k,hide:function(){I(arguments.length>0&&void 0!==arguments[0]&&arguments[0]),document.removeEventListener("click",e)},destroy:function(){t.removeEventListener("click",n),document.removeEventListener("click",e)}}}},N=T[d](),E=N.prepare,S=N.show,L=N.hide,B=N.destroy;E();return{show:S,hide:L,destroy:function(){L(!0),v&&v(),B(),y&&y(),C.remove()}}}return null}function ve(t,e){var n,i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=t.x,l=t.y,s=t.x1,c=t.y1,d=e.x,u=e.y,h=e.x1,f=e.y1;return r?(n=s<d+o||a-o>h,i=c<u+o||l-o>f):(n=s<=d+o||a-o>=h,i=c<=u+o||l-o>=f),!(n||i)}function be(t){var e=t.left,n=t.top,i=t.width,o=t.height,r=document.documentElement,a=r.clientWidth,l=r.clientHeight,s=!1,c=!1;return e+i>a?(e=a-i-8,s=!0):e<0&&(e=8,s=!0),n+o>l?(n=l-o-8,c=!0):n<0&&(n=8,c=!0),{left:e,top:n,leftLimited:s,topLimited:c}}function me(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Symbol("ignoreFirstBind"),i=new Set,o=new ResizeObserver((function(i){e.ignoreFirstBind&&i.some((function(t){var e=t.target,i=e[n];return e[n]=!0,!i}))||t(i)})),r=o.observe;o.observe=function(t,e){i.add(t),r.call(o,t,e)};var a=o.unobserve;o.unobserve=function(t){i.has(t)&&(i.delete(t),t[n]=void 0),a.call(o,t)};var l=o.disconnect;return o.disconnect=function(){var t,e=c(i.values());try{for(e.s();!(t=e.n()).done;){t.value[n]=void 0}}catch(t){e.e(t)}finally{e.f()}l.call(o)},o}function ge(t,e){t.addEventListener("scroll",e),this.scrollHandler.push([t,e])}function ye(){for(var t=0;t<this.scrollHandler.length;t++){var e=C(this.scrollHandler[t],2),n=e[0],i=e[1];n.removeEventListener("scroll",i)}this.scrollHandler=[]}function we(t){for(var e={},n=t.trim().split(";"),i=0;i<n.length;i++){var o=n[i].trim();if(o){var r=o.indexOf(":");if(-1!==r){var a=o.slice(0,Math.max(0,r)).trim(),l=o.slice(Math.max(0,r+1)).trim();e[xe(a)]=l}}}return e}function Ce(t){return Object.entries(t).map((function(t){var e=C(t,2),n=e[0],i=e[1];return"".concat(function(t){var e=t.replaceAll(/([A-Z])/g," $1").trim();return e.split(" ").join("-").toLowerCase()}(n),": ").concat(i,";")})).join(" ")}function xe(t){return t.replaceAll(/-(\w)/g,(function(t,e){return e.toUpperCase()}))}var Me=function(){return Math.random().toString(36).slice(2)};function ke(t,e){var n;return function(){for(var i=this,o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];n&&clearTimeout(n),n=setTimeout((function(){t.apply(i,r)}),e)}}var Ie=e.import("parchment"),Te=e.import("blots/container"),Ne=e.import("blots/block"),Ee=e.import("blots/block/embed"),Se=function(t){function e(){return a(this,e),r(this,e,arguments)}return f(e,t),s(e,[{key:"insertAt",value:function(t,n,i){if(!C(this.children.find(t),1)[0]){var o=this.scroll.create(this.statics.defaultChild.blotName||"block");this.appendChild(o)}x(e,"insertAt",this,3)([t,n,i])}},{key:"optimize",value:function(t){if(0===this.children.length)if(null!=this.statics.defaultChild){var e=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(e)}else this.remove();this.children.length>0&&null!=this.next&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove())}},{key:"enforceAllowedChildren",value:function(){var t=this;this.children.forEach((function(n){t.statics.allowedChildren.some((function(t){return n instanceof t}))||(n.statics.scope===Ie.Scope.BLOCK_BLOT?(n.parent instanceof e?(null!=n.next&&n.parent.splitAfter(n),null!=n.prev&&n.parent.splitAfter(n.prev)):(null!=n.next&&t.splitAfter(n),null!=n.prev&&t.splitAfter(n.prev)),n.parent.unwrap()):n instanceof Ie.ParentBlot?n.unwrap():n.remove())}))}}],[{key:"create",value:function(t){var e=document.createElement(this.tagName);return this.className&&e.classList.add(this.className),e}}])}(Te);d(Se,"tagName",void 0),d(Se,"blotName",N.container),d(Se,"scope",Ie.Scope.BLOCK_BLOT),d(Se,"allowedChildren",[Ne,Ee,Te]),d(Se,"requiredContainer",void 0),d(Se,"defaultChild",void 0);var Le=function(t){return e=t,!Number.isNaN(e)&&Number(e)>0?t:1;var e},Be=e.import("blots/block"),Re=e.import("blots/block/embed"),Oe=function(t){function e(t,n,i){var o;return a(this,e),o=r(this,e,[t,n]),n.setAttribute("contenteditable",String(t.isEnabled())),o}return f(e,t),s(e,[{key:"setFormatValue",value:function(t,e){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]){if(!this.statics.isAllowStyle(t))return;this.parent&&this.parent.statics.blotName===N.tableCell&&this.parent.setFormatValue(t,e)}else{if(!this.statics.allowDataAttrs.has(t))return;var n="data-".concat(t);e?this.domNode.setAttribute(n,e):this.domNode.removeAttribute(n),this.parent&&this.parent.statics.blotName===N.tableCell&&this.parent.setFormatValue(t,e)}var i,o=c(this.descendants(Be,0));try{for(o.s();!(i=o.n()).done;){i.value.cache={}}}catch(t){o.e(t)}finally{o.f()}}},{key:"tableId",get:function(){return this.domNode.dataset.tableId}},{key:"rowId",get:function(){return this.domNode.dataset.rowId},set:function(t){this.setFormatValue("row-id",t)}},{key:"colId",get:function(){return this.domNode.dataset.colId},set:function(t){this.setFormatValue("col-id",t)}},{key:"rowspan",get:function(){return Number(this.domNode.dataset.rowspan)},set:function(t){this.setFormatValue("rowspan",t)}},{key:"colspan",get:function(){return Number(this.domNode.dataset.colspan)},set:function(t){this.setFormatValue("colspan",t)}},{key:"getColumnIndex",value:function(){return q(this,N.tableMain).getColIds().indexOf(this.colId)}},{key:"formatAt",value:function(t,n,i,o){if(0===this.children.length&&(this.appendChild(this.scroll.create(this.statics.defaultChild.blotName)),n+=1),x(e,"formatAt",this,3)([t,n,i,o]),o&&o.style)for(var r=we(o.style),a=0,l=Object.entries(r);a<l.length;a++){var s=C(l[a],2),c=s[0],d=s[1];this.setFormatValue(c,d,!0)}}},{key:"formats",value:function(){var t=this.statics.formats(this.domNode);return d({},this.statics.blotName,t)}},{key:"checkMerge",value:function(){var t=this.colId,e=this.rowId,n=this.colspan,i=this.rowspan,o=this.next;return null!==o&&o.statics.blotName===this.statics.blotName&&o.rowId===e&&o.colId===t&&o.colspan===n&&o.rowspan===i}},{key:"optimize",value:function(){var t=this.parent,e=this.statics.formats(this.domNode);if(this.prev&&this.prev instanceof Re){var n=this.scroll.create("block");this.appendChild(this.prev),this.appendChild(n)}if(null!==t&&t.statics.blotName!==N.tableCell&&(this.wrap(N.tableCell,e),0===this.children.length)){var i=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(i)}this.children.length>0&&null!=this.next&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove()),null!=this.uiNode&&this.uiNode!==this.domNode.firstChild&&this.domNode.insertBefore(this.uiNode,this.domNode.firstChild),0===this.children.length&&this.remove()}},{key:"insertBefore",value:function(t,n){if(t.statics.blotName===this.statics.blotName){var i=t,o=this.statics.formats(i.domNode),r=this.statics.formats(this.domNode);if(Object.entries(r).every((function(t){var e=C(t,2),n=e[0];return e[1]===o[n]})))return this.parent.insertBefore(i,this.next);var a=C(W(this,[N.tableRow,N.tableCell]),2),l=a[0],s=a[1];if(n){var c=n.offset();if(c+1<this.length()){var d=this.scroll.create(N.tableCellInner,r);this.children.forEachAt(c+1,this.length(),(function(t){d.appendChild(t)})),l.insertBefore(d.wrap(N.tableCell,r),s.next),0===this.children.length&&(this.remove(),0===this.parent.children.length&&this.parent.remove())}}if(this.rowId!==i.rowId){if(n){var u=n.offset(l);l.split(u)}else if(s.next){var h=s.next.offset(l);l.split(h)}var f=this.scroll.create(N.tableRow,o),p=this.scroll.create(N.tableCell,o);return p.appendChild(i),f.appendChild(p),l.parent.insertBefore(f,l.next)}return l.insertBefore(i.wrap(N.tableCell,o),n?s:s.next)}x(e,"insertBefore",this,3)([t,n])}}],[{key:"isAllowStyle",value:function(t){var e,n=c(this.allowStyle);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(t.startsWith(i))return!0}}catch(t){n.e(t)}finally{n.f()}return!1}},{key:"create",value:function(t){var n=t.tableId,i=t.rowId,o=t.colId,r=t.rowspan,a=t.colspan,l=t.style,s=x(e,"create",this,2)([]);return s.dataset.tableId=n,s.dataset.rowId=i,s.dataset.colId=o,s.dataset.rowspan=String(Le(r)),s.dataset.colspan=String(Le(a)),l&&(s.dataset.style=l),s}},{key:"formats",value:function(t){var e=t.dataset,n=e.tableId,i=e.rowId,o=e.colId,r=e.rowspan,a=e.colspan,l=e.style,s={tableId:String(n),rowId:String(i),colId:String(o),rowspan:Number(Le(r)),colspan:Number(Le(a))};return l&&(s.style=l),s}}])}(Se);d(Oe,"blotName",N.tableCellInner),d(Oe,"tagName","div"),d(Oe,"className","ql-table-cell-inner"),d(Oe,"allowDataAttrs",new Set(["table-id","row-id","col-id","rowspan","colspan"])),d(Oe,"defaultChild",Be),d(Oe,"allowStyle",new Set(["background-color","border","height"]));var Ae=function(t){function e(){return a(this,e),r(this,e,arguments)}return f(e,t),s(e,[{key:"rowId",get:function(){return this.domNode.dataset.rowId}},{key:"tableId",get:function(){return this.domNode.dataset.tableId}},{key:"setHeight",value:function(t){this.foreachCellInner((function(e){e.setFormatValue("height",t,!0)}))}},{key:"getCellByColId",value:function(t,e){for(var n=q(this,N.tableMain).getColIds(),i=n.indexOf(t),o=this.children.iterator(),r=null;r=o();){if(r.colId===t)return r;var a=n.indexOf(r.colId);if(a<i&&a+r.colspan>i)return r}return this[e]&&this[e].statics.blotName===N.tableRow?this[e].getCellByColId(t,e):null}},{key:"insertCell",value:function(t,e){for(var n,i=[],o=this.children.iterator(),r=0;(n=o())&&!((r+=n.colspan)>t);)if(1!==n.rowspan)for(var a=0;a<n.rowspan-1;a++)i[a]=(i[a]||0)+n.colspan;if(n&&r-n.colspan<t){n.getCellInner().colspan+=1,1!==n.rowspan&&(i.skipRowNum=n.rowspan-1)}else{var l=this.scroll.create(N.tableCell,e),s=this.scroll.create(N.tableCellInner,e),c=this.scroll.create("block");c.appendChild(this.scroll.create("break")),s.appendChild(c),l.appendChild(s),this.insertBefore(l,n)}return i}},{key:"getCellByColumIndex",value:function(t){var e=[],n=null,i=0;if(t<0)return[n,i,e];for(var o=this.children.iterator();n=o();){if(i+=n.colspan,1!==n.rowspan)for(var r=0;r<n.rowspan-1;r++)e[r]=(e[r]||0)+n.colspan;if(i>t)break}return[n,i,e]}},{key:"removeCell",value:function(t){if(t<0)return[];var e=this.getCellByColumIndex(t),n=C(e,2),i=n[0],o=n[1],r=e[2];if(!i)return r;if(o-i.colspan<t||i.colspan>1){var a=C(i.descendants(Oe),1)[0];if(1!==i.colspan&&t===o-i.colspan){var l=q(this,N.tableMain).getColIds();a.colId=l[l.indexOf(a.colId)+1]}1!==i.rowspan&&(r.skipRowNum=i.rowspan-1),a.colspan-=1}else i.remove();return r}},{key:"foreachCellInner",value:function(t){for(var e,n=this.children.iterator(),i=0;e=n();){if(t(C(e.descendants(Oe),1)[0],i++))break}}},{key:"checkMerge",value:function(){var t=this.next;return null!==t&&t.statics.blotName===this.statics.blotName&&t.rowId===this.rowId}},{key:"optimize",value:function(t){var n=this.parent,i=this.tableId;null!==n&&n.statics.blotName!==N.tableBody&&this.wrap(N.tableBody,i),x(e,"optimize",this,3)([t])}}],[{key:"create",value:function(t){var n=x(e,"create",this,2)([]);return n.dataset.tableId=t.tableId,n.dataset.rowId=t.rowId,n}}])}(Se);d(Ae,"blotName",N.tableRow),d(Ae,"tagName","tr"),d(Ae,"className","ql-table-row");var ze=function(t){function e(){return a(this,e),r(this,e,arguments)}return f(e,t),s(e,[{key:"tableId",get:function(){return this.domNode.dataset.tableId}},{key:"insertRow",value:function(t){var e=q(this,N.tableMain);if(e){var n,i=e.getColIds(),o=this.descendants(Ae),r=new Set(i),a=0,l=c(o);try{for(l.s();!(n=l.n()).done;){var s=n.value;if(a===t)break;s.foreachCellInner((function(e){if(a+e.rowspan>t&&(e.rowspan+=1,r.delete(e.colId),1!==e.colspan))for(var n=i.indexOf(e.colId),o=0;o<e.colspan-1;o++)r.delete(i[n+o+1])})),a+=1}}catch(t){l.e(t)}finally{l.f()}var d,u=e.tableId,h=Me(),f=this.scroll.create(N.tableRow,{tableId:u,rowId:h}),p=c(r);try{for(p.s();!(d=p.n()).done;){var v=d.value,b=this.scroll.create("break").wrap("block").wrap(N.tableCellInner,{tableId:u,rowId:h,colId:v,rowspan:1,colspan:1}).wrap(N.tableCell,{tableId:u,rowId:h,colId:v,rowspan:1,colspan:1});f.appendChild(b)}}catch(t){p.e(t)}finally{p.f()}this.insertBefore(f,o[t]||null)}}},{key:"checkMerge",value:function(){var t=this.next;return null!==t&&t.statics.blotName===this.statics.blotName&&t.tableId===this.tableId}},{key:"optimize",value:function(t){var n=this.parent;if(null!==n&&n.statics.blotName!==N.tableMain){var i=this.tableId;this.wrap(N.tableMain,{tableId:i})}x(e,"optimize",this,3)([t])}}],[{key:"create",value:function(t){var n=x(e,"create",this,2)([]);return n.dataset.tableId=t,n}}])}(Se);d(ze,"blotName",N.tableBody),d(ze,"tagName","tbody");var qe=e.import("parchment"),We=function(t){function e(){return a(this,e),r(this,e,arguments)}return f(e,t),s(e,[{key:"replaceWith",value:function(t,e){var n="string"==typeof t?this.scroll.create(t,e):t;if(n instanceof qe.ParentBlot){if(n.statics.blotName===N.tableCellInner){var i=this.parent;if(i.statics.blotName===N.tableCellInner){if(null!=i&&i.insertBefore(n,this.prev?null:this.next),i.statics.blotName===N.tableCellInner)for(var o=this;o;){var r=o.next;n.appendChild(o),o=r}else n.appendChild(this);if(i&&0===i.length()){i.remove(),i.parent.statics.blotName===N.tableCell&&0===i.parent.length()&&i.parent.remove();var a=i.parent.parent;a.statics.blotName===N.tableRow&&0===a.children.length&&a.remove()}}else null!=i&&i.insertBefore(n,this.next),n.appendChild(this);return n}this.moveChildren(n)}return null!=this.parent&&(this.parent.insertBefore(n,this.next||void 0),this.remove()),this.attributes.copy(n),n}},{key:"format",value:function(t,n){if(t!==N.tableCellInner||this.parent.statics.blotName!==t||n)x(e,"format",this,3)([t,n]);else try{q(this,N.tableCellInner).unwrap()}catch(t){console.error("unwrap TableCellInner error")}}}])}(e.import("blots/block")),He=e.import("parchment"),De=function(t){function n(){return a(this,n),r(this,n,arguments)}return f(n,t),s(n,[{key:"enable",value:function(){for(var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=e.import("formats/".concat(N.tableCellInner)),o=this.domNode.querySelectorAll(".".concat(i.className)),r=0,a=Array.from(o);r<a.length;r++){a[r].setAttribute("contenteditable",String(!!t))}for(var l=e.import("formats/".concat(N.tableCaption)),s=this.domNode.querySelectorAll(".".concat(l.className)),c=0,d=Array.from(s);c<d.length;c++){d[c].setAttribute("contenteditable",String(!!t))}x(n,"enable",this,3)([t])}},{key:"createBlock",value:function(t,e){var n,i={};if(t[N.tableCellInner])n=N.tableCellInner;else for(var o=0,r=Object.entries(t);o<r.length;o++){var a=C(r[o],2),l=a[0],s=a[1];null!=this.query(l,He.Scope.BLOCK&He.Scope.BLOT)?n=l:i[l]=s}n===N.tableCellInner&&delete(i=b({},t))[n];var c=this.create(n||this.statics.defaultChild.blotName,n?t[n]:void 0);this.insertBefore(c,e||void 0);var d=c.length();c instanceof Oe&&0===d&&(d+=1);for(var u=0,h=Object.entries(i);u<h.length;u++){var f=C(h[u],2),p=f[0],v=f[1];c.formatAt(0,d,p,v)}return c}}])}(e.import("blots/scroll")),je=e.import("parchment"),Pe=e.import("blots/inline"),Fe=e.import("blots/text"),_e=function(t){function e(t,n,i){var o;return a(this,e),o=r(this,e,[t,n]),n.setAttribute("contenteditable",String(t.isEnabled())),o.attachUI(o.createUI()),o.domNode.addEventListener("mouseenter",(function(){o.scroll.isEnabled()&&(o.uiNode.style.display="flex")})),o.domNode.addEventListener("mouseleave",(function(){o.scroll.isEnabled()&&(o.uiNode.style.display="none")})),o}return f(e,t),s(e,[{key:"createUI",value:function(){var t=this,e=document.createElement("i");return e.classList.add("ql-table-caption--switch"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\r\n  \x3c!-- Icon from Tabler Icons by Pawe Kuna - https://github.com/tabler/tabler-icons/blob/master/LICENSE --\x3e\r\n  <path\r\n    fill="none"\r\n    stroke="currentColor"\r\n    stroke-linecap="round"\r\n    stroke-linejoin="round"\r\n    stroke-width="2"\r\n    d="M7 3v18m3-15L7 3L4 6m16 12l-3 3l-3-3m3 3V3"\r\n  />\r\n</svg>\r\n',e.addEventListener("click",(function(){t.scroll.isEnabled()&&(t.side="top"===t.side?"bottom":"top")})),e}},{key:"tableId",get:function(){return this.domNode.dataset.tableId}},{key:"side",get:function(){return"bottom"===this.domNode.style.captionSide?"bottom":"top"},set:function(t){this.domNode.style.captionSide="bottom"===t?"bottom":"top"}},{key:"format",value:function(t,n){this.scroll.query(t,je.Scope.BLOCK_BLOT)&&t!==this.statics.blotName||x(e,"format",this,3)([t,n])}},{key:"checkMerge",value:function(){var t=this.next;return null!==t&&t.statics.blotName===this.statics.blotName&&t.tableId===this.tableId}},{key:"optimize",value:function(t){var n=this.parent;if(null!==n&&n.statics.blotName!==N.tableMain){var i=this.tableId;this.wrap(N.tableMain,{tableId:i})}0===this.children.length?this.remove():(x(e,"optimize",this,3)([t]),null!=this.next&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove()))}}],[{key:"create",value:function(t){var n=t.tableId,i=x(e,"create",this,2)([]);return i.dataset.tableId=n,"bottom"===t.side&&(i.style.captionSide="bottom"),i}},{key:"formats",value:function(t){var e=t.dataset.tableId;return{tableId:String(e),side:"bottom"===t.style.captionSide?"bottom":"top"}}}])}(We);d(_e,"blotName",N.tableCaption),d(_e,"tagName","caption"),d(_e,"className","ql-table-caption"),d(_e,"allowedChildren",[Pe,Fe]);var Ve=function(t){function e(){return a(this,e),r(this,e,arguments)}return f(e,t),s(e,[{key:"setFormatValue",value:function(t,e){if(this.statics.allowAttrs.has(t)||this.statics.allowDataAttrs.has(t)){var n=t;this.statics.allowDataAttrs.has(t)&&(n="data-".concat(t)),e?this.domNode.setAttribute(n,e):this.domNode.removeAttribute(n)}else this.statics.isAllowStyle(t)&&(Object.assign(this.domNode.style,d({},t,e)),t.startsWith("border")&&this.setStyleBoder(t,e));this.children.head&&this.children.head.statics.blotName===N.tableCellInner&&this.domNode.style.cssText&&(this.children.head.domNode.dataset.style=this.domNode.style.cssText)}},{key:"setStyleBoder",value:function(t,e){var n=Boolean(e)?e:null;if(!["left","right","top","bottom"].some((function(e){return t.includes(e)}))&&t.startsWith("border-")){var i,o=c(this.getNearByCell("left").map((function(t){return t.descendant(Oe,0)[0]})).filter(Boolean));try{for(o.s();!(i=o.n()).done;){i.value.setFormatValue(t.replace("border-","border-right-"),n,!0)}}catch(t){o.e(t)}finally{o.f()}var r,a=c(this.getNearByCell("top").map((function(t){return t.descendant(Oe,0)[0]})).filter(Boolean));try{for(a.s();!(r=a.n()).done;){r.value.setFormatValue(t.replace("border-","border-bottom-"),n,!0)}}catch(t){a.e(t)}finally{a.f()}}}},{key:"getNearByCell",value:function(t){var e=[];try{var n=q(this,N.tableMain);e.push.apply(e,M(n.getColIds()))}catch(t){console.error("Cell is not in table! ".concat(t))}if(0===e.length)return[];if("left"===t){for(var i=new Set,o=this.parent,r=0;r<this.rowspan&&o instanceof Ae;r++){for(var a=o.children.iterator(),l=null;l=a();){var s=e.indexOf(l.colId)+l.colspan;this.colId===e[s]&&i.add(l)}o=o.next}return Array.from(i)}if("top"===t){if(!(this.parent instanceof Ae&&this.parent.prev))return[];for(var c=new Set,d=this.getColumnIndex(),u=d+this.colspan,h=new Set(e.filter((function(t,e){return e>=d&&e<u}))),f=1,p=this.parent.prev;p;){for(var v=!1,b=p.children.iterator(),m=null,g=0;m=b();)h.has(m.colId)&&m.rowspan>=f&&(c.add(m),h.delete(m.colId)),g+=m.colspan,m.rowspan>=f&&(v=!0);if(!v&&g===e.length)break;p=p.prev,f+=1}return Array.from(c)}return[]}},{key:"tableId",get:function(){return this.domNode.dataset.tableId}},{key:"rowId",get:function(){return this.domNode.dataset.rowId}},{key:"colId",get:function(){return this.domNode.dataset.colId}},{key:"rowspan",get:function(){return Number(this.domNode.getAttribute("rowspan"))}},{key:"colspan",get:function(){return Number(this.domNode.getAttribute("colspan"))}},{key:"getColumnIndex",value:function(){return q(this,N.tableMain).getColIds().indexOf(this.colId)}},{key:"getCellInner",value:function(){return this.children.head}},{key:"checkMerge",value:function(){var t=this.colId,e=this.rowId,n=this.colspan,i=this.rowspan,o=this.next;return null!==o&&o.statics.blotName===this.statics.blotName&&o.rowId===e&&o.colId===t&&o.colspan===n&&o.rowspan===i}},{key:"optimize",value:function(t){var n=this.parent,i=this.tableId,o=this.rowId;null!==n&&n.statics.blotName!==N.tableRow&&this.wrap(N.tableRow,{tableId:i,rowId:o}),x(e,"optimize",this,3)([t])}}],[{key:"isAllowStyle",value:function(t){var e,n=c(this.allowStyle);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(t.startsWith(i))return!0}}catch(t){n.e(t)}finally{n.f()}return!1}},{key:"create",value:function(t){var n=t.tableId,i=t.rowId,o=t.colId,r=t.rowspan,a=t.colspan,l=t.style,s=x(e,"create",this,2)([]);return s.dataset.tableId=n,s.dataset.rowId=i,s.dataset.colId=o,s.setAttribute("rowspan",String(Le(r))),s.setAttribute("colspan",String(Le(a))),l&&(s.style.cssText=l),s}},{key:"formats",value:function(t){for(var e=t.dataset,n=e.tableId,i=e.rowId,o=e.colId,r=Number(t.getAttribute("rowspan")),a=Number(t.getAttribute("colspan")),l={tableId:n,rowId:i,colId:o,rowspan:Le(r),colspan:Le(a)},s={},c=0;c<t.style.length;c++){var d=t.style[c],u=t.style[d];this.isAllowStyle(String(d))&&!["initial","inherit"].includes(u)&&(s[d]=u)}var h=Object.entries(s);return h.length>0&&(l.style=h.map((function(t){var e=C(t,2),n=e[0],i=e[1];return"".concat(n,": ").concat(i)})).join(";")),l}}])}(Se);d(Ve,"blotName",N.tableCell),d(Ve,"tagName","td"),d(Ve,"className","ql-table-cell"),d(Ve,"allowDataAttrs",new Set(["table-id","row-id","col-id"])),d(Ve,"allowAttrs",new Set(["rowspan","colspan"])),d(Ve,"allowStyle",new Set(["background-color","border","height"]));var Xe=function(t){function e(){return a(this,e),r(this,e,arguments)}return f(e,t),s(e,[{key:"width",get:function(){var t=this.domNode.getAttribute("width");if(!t){if(t=this.domNode.getBoundingClientRect().width,this.full){var e=this.domNode.closest("table");return e?t/100*e.getBoundingClientRect().width:E[this.full?"colMinWidthPre":"colMinWidthPx"]}return t}return Number.parseFloat(String(t))},set:function(t){var e=Number.parseFloat(String(t));Number.isNaN(e)&&(e=E[this.full?"colMinWidthPre":"colMinWidthPx"]),this.domNode.setAttribute("width",this.statics.validWidth(e,!!this.full))}},{key:"tableId",get:function(){return this.domNode.dataset.tableId}},{key:"colId",get:function(){return this.domNode.dataset.colId}},{key:"full",get:function(){return Object.hasOwn(this.domNode.dataset,"full")},set:function(t){t?this.domNode.dataset.full=String(!0):this.domNode.removeAttribute("data-full")}},{key:"align",get:function(){return this.domNode.dataset.align||""},set:function(t){"right"===t||"center"===t?this.domNode.dataset.align=t:this.domNode.removeAttribute("data-align")}},{key:"checkMerge",value:function(){var t=this.next,e=this.tableId,n=this.colId;return null!==t&&t.statics.blotName===this.statics.blotName&&t.tableId===e&&t.colId===n}},{key:"optimize",value:function(t){var n=this.parent;if(null!=n&&n.statics.blotName!==N.tableColgroup){var i=this.statics.value(this.domNode);this.wrap(N.tableColgroup,i)}q(this,N.tableColgroup).align=this.align,null!=this.next&&this.checkMerge()&&this.next.remove(),x(e,"optimize",this,3)([t]);try{var o=q(this,N.tableColgroup),r=!0;o.children.forEach((function(t){r&&(r=t.full)})),o.full=r}catch(t){}}},{key:"insertAt",value:function(t,n,i){var o=this;if(null==i){var r=n.split("\n"),a=r.pop(),l=r.map((function(t){var e=o.scroll.create("block");return e.insertAt(0,t),e})),s=this.split(t),d=C(W(this,[N.tableColgroup,N.tableMain]),2),u=d[0],h=d[1],f=u.next;if(s){var p=s.offset(u);u.split(p)}var v=h.parent.parent,b=h.parent.next;if(f){var m=f.descendants(Oe);if(m.length>0){var g=m[0],y=Oe.formats(g.domNode),w=this.scroll.create("block"),M=w.wrap(N.tableCellInner,y).wrap(N.tableCell,y).wrap(N.tableRow,y).wrap(N.tableBody,y.tableId);u.parent.insertBefore(M,u.next),v=w,b=w.next}}var k,I=c(l);try{for(I.s();!(k=I.n()).done;){var T=k.value;v.insertBefore(T,b)}}catch(t){I.e(t)}finally{I.f()}a&&v.insertBefore(this.scroll.create("text",a),b)}else x(e,"insertAt",this,3)([t,n,i])}}],[{key:"validWidth",value:function(t,e){var n=Number.parseFloat(String(t));return Number.isNaN(n)&&(n=E[e?"colMinWidthPre":"colMinWidthPx"]),"".concat(n).concat(e?"%":"px")}},{key:"create",value:function(t){var n=t.width,i=t.tableId,o=t.colId,r=t.full,a=t.align,l=x(e,"create",this,2)([]);return l.setAttribute("width",this.validWidth(n,!!r)),r&&(l.dataset.full=String(r)),a&&"left"!==a&&(l.dataset.align=a),l.dataset.tableId=i,l.dataset.colId=o,l}},{key:"value",value:function(t){var e=t.dataset,n=e.tableId,i=e.colId,o=t.getAttribute("width")||String(E.colDefaultWidth),r=t.dataset.align,a=Object.hasOwn(t.dataset,"full"),l={tableId:String(n),colId:String(i),full:a,width:Number.parseFloat(o)};return r&&(l.align=r),l}}])}(e.import("blots/block/embed"));d(Xe,"blotName",N.tableCol),d(Xe,"tagName","col");var Ue=function(t){function e(t,n,i){var o;return a(this,e),(o=r(this,e,[t,n])).updateAlign(),o}return f(e,t),s(e,[{key:"colWidthFillTable",value:function(){if(this.full)Object.assign(this.domNode.style,{width:null});else{var t=this.getCols();if(t){var e=t.reduce((function(t,e){return e.width+t}),0);if(0!==e&&!Number.isNaN(e))return this.domNode.style.width="".concat(e,"px"),e}}}},{key:"tableId",get:function(){return this.domNode.dataset.tableId}},{key:"full",get:function(){return Object.hasOwn(this.domNode.dataset,"full")},set:function(t){t?this.domNode.dataset.full=String(!0):this.domNode.removeAttribute("data-full"),this.colWidthFillTable()}},{key:"align",get:function(){return this.domNode.dataset.align||""},set:function(t){"right"===t||"center"===t?this.domNode.dataset.align=t:this.domNode.removeAttribute("data-align"),this.updateAlign()}},{key:"setFull",value:function(){if(!this.full){var t=this.getCols();if(0!==t.length){var e,n=Math.floor(this.domNode.getBoundingClientRect().width),i=c(t);try{for(i.s();!(e=i.n()).done;){var o=e.value,r=o.width/n*100;o.full=!0,o.width=r}}catch(t){i.e(t)}finally{i.f()}}}}},{key:"cancelFull",value:function(){if(this.full){var t=this.getCols();if(0!==t.length){var e,n=Math.floor(this.domNode.getBoundingClientRect().width),i=c(t);try{for(i.s();!(e=i.n()).done;){var o=e.value;o.full=!1,o.width=Math.max(o.width/100*n,E.colMinWidthPx)}}catch(t){i.e(t)}finally{i.f()}}}}},{key:"updateAlign",value:function(){var t={marginLeft:null,marginRight:null};switch(this.align){case"center":t.marginLeft="auto",t.marginRight="auto";break;case"":case"left":t.marginRight="auto";break;case"right":t.marginLeft="auto"}Object.assign(this.domNode.style,t)}},{key:"getRows",value:function(){return this.descendants(Ae)}},{key:"getRowIds",value:function(){return this.getRows().map((function(t){return t.rowId}))}},{key:"getCols",value:function(){return this.descendants(Xe)}},{key:"getColIds",value:function(){return this.getCols().map((function(t){return t.colId}))}},{key:"checkMerge",value:function(){var t=this.next;return null!==t&&t.statics.blotName===this.statics.blotName&&t.domNode.dataset.tableId===this.tableId}},{key:"optimize",value:function(t){var n=this.parent;null!==n&&n.statics.blotName!==N.tableWrapper&&this.wrap(N.tableWrapper,this.tableId),x(e,"optimize",this,3)([t])}}],[{key:"create",value:function(t){var n=x(e,"create",this,2)([]),i=t.tableId,o=t.full,r=t.align;return n.dataset.tableId=i,"right"===r||"center"===r?n.dataset.align=r:n.removeAttribute("date-align"),o&&(n.dataset.full=String(o)),n.setAttribute("cellpadding","0"),n.setAttribute("cellspacing","0"),n}}])}(Se);d(Ue,"blotName",N.tableMain),d(Ue,"tagName","table"),d(Ue,"className","ql-table");var Ye=function(t){function e(){return a(this,e),r(this,e,arguments)}return f(e,t),s(e,[{key:"tableId",get:function(){return this.domNode.dataset.tableId}},{key:"full",get:function(){return Object.hasOwn(this.domNode.dataset,"full")},set:function(t){t?this.domNode.dataset.full=String(!0):this.domNode.removeAttribute("data-full"),this.parent&&this.parent instanceof Ue&&(this.parent.full=t)}},{key:"align",get:function(){return this.domNode.dataset.align||""},set:function(t){"right"===t||"center"===t?this.domNode.dataset.align=t:this.domNode.removeAttribute("data-align")}},{key:"findCol",value:function(t){for(var e,n=this.children.iterator(),i=0;(e=n())&&i!==t;)i++;return e}},{key:"insertColByIndex",value:function(t,e){var n=this.parent;if(!(n instanceof Ue))throw new TypeError("TableColgroupFormat should be child of TableFormat");var i=this.findCol(t),o=this.scroll.create(N.tableCol,e);if(n.full)for(var r,a=this.children.iterator();r=a();)if(r.width-o.width>=E.colMinWidthPre){r.width-=o.width;break}this.insertBefore(o,i)}},{key:"removeColByIndex",value:function(t){var e=this.parent;if(!(e instanceof Ue))throw new TypeError("TableColgroupFormat should be child of TableMainFormat");var n=this.findCol(t);n&&(e.full&&(n.next?n.next.width+=n.width:n.prev&&(n.prev.width+=n.width)),n.remove(),e.colWidthFillTable())}},{key:"checkMerge",value:function(){var t=this.next,e=this.parent;return e instanceof Ue&&!e.full&&e.colWidthFillTable(),null!==t&&t.statics.blotName===this.statics.blotName&&t.tableId===this.tableId}},{key:"optimize",value:function(t){var n=this.parent,i=this.tableId,o=this.full,r=this.align;null!=n&&n.statics.blotName!==N.tableMain&&this.wrap(N.tableMain,{tableId:i,full:o,align:r}),q(this,N.tableMain).align=r,x(e,"optimize",this,3)([t])}}],[{key:"create",value:function(t){var n=x(e,"create",this,2)([]);return n.dataset.tableId=t.tableId,t.full&&(n.dataset.full=String(t.full)),t.align&&"left"!==t.align&&(n.dataset.align=t.align),n.setAttribute("contenteditable","false"),n}}])}(Se);d(Ye,"blotName",N.tableColgroup),d(Ye,"tagName","colgroup");var Ge=e.import("parchment"),Ke=function(t){function n(t,i,o){var l;return a(this,n),d(l=r(this,n,[t,i]),"scroll",void 0),d(l,"insertLineAround",(function(){l.prev&&l.prev instanceof Ge.BlockBlot||l.parent.insertBefore(l.scroll.create("block"),l),l.next&&l.next instanceof Ge.BlockBlot||l.parent.insertBefore(l.scroll.create("block"),l.next)})),l.scroll=t,l.scroll.emitter.on(e.events.TEXT_CHANGE,l.insertLineAround),l}return f(n,t),s(n,[{key:"tableId",get:function(){return this.domNode.dataset.tableId}},{key:"checkMerge",value:function(){var t=this.next;return null!==t&&t.statics.blotName===this.statics.blotName&&t.tableId===this.tableId}},{key:"deleteAt",value:function(t,e){x(n,"deleteAt",this,3)([t,e]);var i=this.descendants(ze),o=this.descendants(Ye);0!==i.length&&0!==o.length||this.remove()}},{key:"remove",value:function(){x(n,"remove",this,3)([]),this.scroll.emitter.off(e.events.TEXT_CHANGE,this.insertLineAround)}}],[{key:"create",value:function(t){var e=x(n,"create",this,2)([]);return e.dataset.tableId=t,e.addEventListener("dragstart",(function(t){t.preventDefault(),t.stopPropagation()}),!0),e.addEventListener("drop",(function(t){t.preventDefault()})),e.addEventListener("dragover",(function(t){t.preventDefault(),t.dataTransfer.dropEffect="none"})),e.setAttribute("contenteditable","false"),e}}])}(Se);function Ze(t){var e=C(D(t,ze),1)[0];return{body:e,rect:e.domNode.getBoundingClientRect()}}d(Ke,"blotName",N.tableWrapper),d(Ke,"tagName","div"),d(Ke,"className","ql-table-wrapper");var $e=function(){return s((function t(n,i,o){var r=this;a(this,t),d(this,"tableModule",void 0),d(this,"table",void 0),d(this,"quill",void 0),d(this,"tableBlot",void 0),d(this,"tableWrapperBlot",void 0),d(this,"alignBox",void 0),d(this,"cleanup",void 0),d(this,"bem",z("align")),d(this,"resizeObserver",me((function(){return r.update()}),{ignoreFirstBind:!0})),d(this,"updateWhenTextChange",(function(){r.update()})),this.tableModule=n,this.table=i,this.quill=o,this.tableBlot=e.find(i),this.tableWrapperBlot=this.tableBlot.parent,this.alignBox=this.buildTool(),this.resizeObserver.observe(this.table),this.quill.on(e.events.TEXT_CHANGE,this.updateWhenTextChange),this.show()}),[{key:"buildTool",value:function(){for(var t=this,n=this.tableModule.addContainer(this.bem.b()),i=e.import("ui/icons"),o={left:i.align[""],center:i.align.center,right:i.align.right},r=function(){var i=C(l[a],2),o=i[0],r=i[1],s=document.createElement("span");s.dataset.align=o,s.classList.add(t.bem.be("item")),s.innerHTML='<i class="icon">'.concat(r,"</i>"),s.addEventListener("click",(function(){var n=s.dataset.align;n&&(t.setTableAlign(t.tableBlot,n),t.quill.once(e.events.SCROLL_OPTIMIZE,(function(){t.tableModule.tableSelection&&t.tableModule.tableSelection.hide(),t.tableModule.tableResize&&t.tableModule.tableResize.update(),t.tableModule.tableResizeScale&&t.tableModule.tableResizeScale.update(),t.tableModule.tableScrollbar&&t.tableModule.tableScrollbar.update()})))})),n.appendChild(s)},a=0,l=Object.entries(o);a<l.length;a++)r();return this.cleanup||(this.cleanup=le(this.tableWrapperBlot.domNode,n,(function(){return t.update()}))),n}},{key:"setTableAlign",value:function(t,e){var n,i=c(t.getCols());try{for(i.s();!(n=i.n()).done;){n.value.align=e}}catch(t){i.e(t)}finally{i.f()}}},{key:"show",value:function(){this.alignBox&&(this.alignBox.classList.add(this.bem.bm("active")),this.update())}},{key:"hide",value:function(){this.alignBox&&(this.alignBox.classList.remove(this.bem.bm("active")),this.cleanup&&(this.cleanup(),this.cleanup=void 0))}},{key:"update",value:function(){var t=this;this.alignBox&&(this.tableBlot.full||this.tableBlot.domNode.offsetWidth>=this.quill.root.offsetWidth?this.hide():he(this.tableWrapperBlot.domNode,this.alignBox,{placement:"top",middleware:[de(),ce({limiter:ue()}),se(16)]}).then((function(e){var n=e.x,i=e.y;Object.assign(t.alignBox.style,{left:"".concat(n,"px"),top:"".concat(i,"px")})})))}},{key:"destroy",value:function(){this.hide(),this.resizeObserver.disconnect(),this.quill.off(e.events.TEXT_CHANGE,this.updateWhenTextChange),this.alignBox&&(this.alignBox.remove(),this.alignBox=void 0)}}])}(),Qe=["style"],Je=["attributes"],tn=["attributes"],en=["background"],nn=e.import("delta");function on(t){var e=Number.parseFloat(t.getAttribute("width")||String(E.colDefaultWidth));if(Number.isNaN(e)){var n=t.style.width;e=n?Number.parseFloat(n):t.offsetWidth}return e}var rn=function(t){function e(t,n){var i;return a(this,e),d(i=r(this,e,[t,n]),"quill",void 0),d(i,"tableId",Me()),d(i,"rowId",Me()),d(i,"colIds",[]),d(i,"rowspanCount",[]),d(i,"cellCount",0),d(i,"colCount",0),i.quill=t,i.addMatcher("table",i.matchTable.bind(i)),i.addMatcher("tbody",i.matchTbody.bind(i)),i.addMatcher("colgroup",i.matchColgroup.bind(i)),i.addMatcher("col",i.matchCol.bind(i)),i.addMatcher("tr",i.matchTr.bind(i)),i.addMatcher("td",i.matchTd.bind(i)),i.addMatcher("th",i.matchTd.bind(i)),i.addMatcher("caption",i.matchCaption.bind(i)),i.addMatcher(Node.ELEMENT_NODE,i.matchTdAttributor.bind(i)),i}return f(e,t),s(e,[{key:"matchTable",value:function(t,e){var n=this;if(0===e.ops.length)return e;for(var i=[],o=[],r=-1,a=0;a<e.ops.length;a++){var l=e.ops[a],s=l.attributes,u=l.insert,h=s||{},f=N.tableCell;h.table,h[f];var p=m(h,["table",f].map(k)),v=Z(u)&&u[N.tableCol];v?o.push({insert:u}):i.push({attributes:p,insert:u}),null!=p&&p[N.tableCellInner]||v||(r=a)}var b=function(t,e){for(var n=new Array(e).fill(E.colDefaultWidth),i=0,o=Array.from(t.querySelectorAll("tr"));i<o.length;i++){var r,a=o[i],l=c(Array.from(a.querySelectorAll("td")).entries());try{for(l.s();!(r=l.n()).done;){var s=C(r.value,2),d=s[0],u=s[1];if(!(d<e))break;var h=on(u);n[d]=h||n[d]}}catch(t){l.e(t)}finally{l.f()}}return n}(t,this.colIds.length).reduce((function(t,e,i){return o[i]?t.push(o[i]):t.push({insert:d({},N.tableCol,{tableId:n.tableId,colId:n.colIds[i],width:e,full:!1})}),t}),[]);return i.splice.apply(i,[r+1,0].concat(M(b))),this.tableId=Me(),this.colIds=[],this.rowspanCount=[],this.cellCount=0,this.colCount=0,new nn(i)}},{key:"matchTbody",value:function(t,e){var n=t.style.backgroundColor;if(n){var i,o=c(e.ops);try{for(o.s();!(i=o.n()).done;){var r,a=i.value;if(null!==(r=a.attributes)&&void 0!==r&&r[N.tableCellInner]){var l=a.attributes[N.tableCellInner],s=l.style,d=m(l,Qe),u=we(s||"");u.backgroundColor||(u.backgroundColor=n,a.attributes[N.tableCellInner]=b(b({},d),{},{style:Ce(u)}))}}}catch(t){o.e(t)}finally{o.f()}}return e}},{key:"matchColgroup",value:function(t,e){for(var n=[],i=0;i<e.ops.length;i++){var o=e.ops[i];o&&Z(o.insert)&&o.insert[N.tableCol]&&n.push(o)}return new nn(n)}},{key:"matchCol",value:function(t){this.colIds[this.colCount]=Me();var e=(new nn).insert(d({},N.tableCol,Object.assign(Xe.value(t),{tableId:this.tableId,colId:this.colIds[this.colCount]})));return this.colCount+=1,e}},{key:"matchTr",value:function(t,e){this.rowId=Me(),this.cellCount=0;var n,i=c(this.rowspanCount.entries());try{for(i.s();!(n=i.n()).done;){var o=C(n.value,2),r=o[0],a=o[1];a.rowspan>0&&(a.rowspan-=1),a.rowspan<=0&&(this.rowspanCount[r]={rowspan:0,colspan:0})}}catch(t){i.e(t)}finally{i.f()}var l,s=c(e.ops);try{for(s.s();!(l=s.n()).done;){var d=l.value;if(d.attributes){var u=d.attributes,h=u.background,f=u[N.tableCellInner];if(f&&h){var p=f.style,v=we(void 0===p?"":p);v.backgroundColor=h,d.attributes[N.tableCellInner].style=Ce(v)}}}}catch(t){s.e(t)}finally{s.f()}return e}},{key:"matchTd",value:function(t,e){var n=t,i=Ve.formats(n);if(!this.colIds[this.cellCount]||!this.rowspanCount[this.cellCount])for(var o=this.cellCount;o>=0;o--)this.colIds[o]||(this.colIds[o]=Me()),this.rowspanCount[o]||(this.rowspanCount[o]={rowspan:0,colspan:0});var r=this.rowspanCount[this.cellCount].colspan;this.cellCount+=r,i.rowspan>1&&(this.rowspanCount[this.cellCount]={rowspan:i.rowspan,colspan:i.colspan});var a=this.colIds[this.cellCount];this.cellCount+=i.colspan;var l=Object.assign(i,{tableId:this.tableId,rowId:this.rowId,colId:a});"none"===n.style.border&&(l.style=l.style.replaceAll(/border-(top|right|bottom|left)-style:none;?/g,""));var s,u=[],h=c(e.ops);try{for(h.s();!(s=h.n()).done;){var f=s.value,p=f.attributes,v=void 0===p?{}:p,g=m(f,Je),y=N.tableCell,w=(v[y],m(v,[y].map(k)));u.push(b(b({},g),{},{attributes:b(b({},w),{},d({},N.tableCellInner,l))}))}}catch(t){h.e(t)}finally{h.f()}return(u.length<=0||!K(u[u.length-1].insert)||!u[u.length-1].insert.endsWith("\n"))&&u.push({insert:"\n",attributes:d({},N.tableCellInner,l)}),new nn(u)}},{key:"matchTdAttributor",value:function(t,e){if("td"===t.tagName.toLocaleLowerCase()){var n,i=[],o=c(e.ops);try{for(o.s();!(n=o.n()).done;){var r=n.value,a=r.attributes,l=m(r,tn),s=null==a?void 0:a[N.tableCellInner];if(a&&s&&s.style){var d=a.background,u=m(a,en),h=document.createElement("div");h.style.background=d;var f=document.createElement("div");if(f.style.cssText=s.style,h.style.background===f.style.backgroundColor){i.push(b(b({},l),{},{attributes:b({},u)}));continue}}i.push(r)}}catch(t){o.e(t)}finally{o.f()}return new nn(i)}return e}},{key:"convert",value:function(t){var n=t.html,i=t.text,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=x(e,"convert",this,3)([{html:n,text:i},o]);if(o[N.tableCellInner]){var a,l=c(r.ops);try{for(l.s();!(a=l.n()).done;){var s=a.value;Z(s.insert)&&s.insert[N.tableCol]?s.insert="":(s.attributes||(s.attributes={}),s.attributes[N.tableCellInner]=o[N.tableCellInner])}}catch(t){l.e(t)}finally{l.f()}}return r}},{key:"matchCaption",value:function(t,e){for(var n=0;n<e.ops.length;n++){var i=e.ops[n],o=i.attributes;o&&o[N.tableCaption]&&(o[N.tableCaption].tableId=this.tableId,i.attributes=o)}return e}}])}(e.import("modules/clipboard")),an="color-selector",ln={Break:{name:"break"},CopyCell:{name:"CopyCell",tip:"Copy cell",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 256">\n  <g fill="currentColor">\n    <path d="M216 40v128h-48V88H88V40Z" opacity=".2" />\n    <path\n      d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"\n    />\n  </g>\n</svg>\n',handle:function(t,e){var n=t.getTextByCell(e),i=t.getHTMLByCell(e),o=new ClipboardItem({"text/plain":new Blob([n],{type:"text/plain"}),"text/html":new Blob([i],{type:"text/html"})});navigator.clipboard.write([o]),t.hideTableTools()}},CutCell:{name:"CutCell",tip:"Cut cell",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 32 32">\n  <path\n    fill="currentColor"\n    d="m19.05 13.733l-1-1.733l-10.122 5.846l-.997-.576a3 3 0 0 0 .667-.769A3 3 0 1 0 3.5 17.599L5.928 19L3.5 20.402a3.034 3.034 0 1 0 3.44.323l.988-.57L14.59 24l1-1.73L9.928 19zM4.034 15.26a1 1 0 1 1 .466.607a1 1 0 0 1-.466-.607M5 22a1 1 0 1 1-.865 1.5A1 1 0 0 1 5 22m12 4h4v2h-4zm-7 0h4v2h-4z"\n  />\n  <path fill="currentColor" d="M28 28h-4v-2h4V4H7v4H5V4a2 2 0 0 1 2-2h21a2 2 0 0 1 2 2v22a2 2 0 0 1-2 2" />\n</svg>\n',handle:function(t,e){var n=t.getTextByCell(e),i=t.getHTMLByCell(e,!0),o=new ClipboardItem({"text/plain":new Blob([n],{type:"text/plain"}),"text/html":new Blob([i],{type:"text/html"})});navigator.clipboard.write([o]),t.hideTableTools()}},InsertTop:{name:"InsertTop",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\n  <path\n    fill="currentColor"\n    d="M4 3h14a2 2 0 0 1 2 2v7.08a6 6 0 0 0-4.32.92H12v4h1.08c-.11.68-.11 1.35 0 2H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2m0 4v4h6V7zm8 0v4h6V7zm-8 6v4h6v-4zm17.94 4.5h-2v4h-2v-4h-2l3-3z"\n  />\n</svg>\n',tip:"Insert row above",handle:function(t,e){t.appendRow(e,!1),t.hideTableTools()}},InsertRight:{name:"InsertRight",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\n  <path\n    fill="currentColor"\n    d="M4 3h14a2 2 0 0 1 2 2v7.08a6 6 0 0 0-4.32.92H12v4h1.08c-.11.68-.11 1.35 0 2H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2m0 4v4h6V7zm8 0v4h6V7zm-8 6v4h6v-4zm15.44 8v-2h-4v-2h4v-2l3 3z"\n  />\n</svg>\n',tip:"Insert column right",handle:function(t,e){t.appendCol(e,!0),t.hideTableTools()}},InsertBottom:{name:"InsertBottom",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\n  <path\n    fill="currentColor"\n    d="M4 3h14a2 2 0 0 1 2 2v7.08a6 6 0 0 0-4.32.92H12v4h1.08c-.11.68-.11 1.35 0 2H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2m0 4v4h6V7zm8 0v4h6V7zm-8 6v4h6v-4zm11.94 5.5h2v-4h2v4h2l-3 3z"\n  />\n</svg>\n',tip:"Insert row below",handle:function(t,e){t.appendRow(e,!0),t.hideTableTools()}},InsertLeft:{name:"InsertLeft",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\n  <path\n    fill="currentColor"\n    d="M4 3h14a2 2 0 0 1 2 2v7.08a6 6 0 0 0-4.32.92H12v4h1.08c-.11.68-.11 1.35 0 2H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2m0 4v4h6V7zm8 0v4h6V7zm-8 6v4h6v-4zm14.44 2v2h4v2h-4v2l-3-3z"\n  />\n</svg>\n',tip:"Insert column Left",handle:function(t,e){t.appendCol(e,!1),t.hideTableTools()}},MergeCell:{name:"MergeCell",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\n  <path\n    fill="currentColor"\n    d="M5 10H3V4h8v2H5zm14 8h-6v2h8v-6h-2zM5 18v-4H3v6h8v-2zM21 4h-8v2h6v4h2zM8 13v2l3-3l-3-3v2H3v2zm8-2V9l-3 3l3 3v-2h5v-2z"\n  />\n</svg>\n',tip:"Merge Cell",handle:function(t,e){t.mergeCells(e),t.hideTableTools()}},SplitCell:{name:"SplitCell",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\n  <path\n    fill="currentColor"\n    d="M19 14h2v6H3v-6h2v4h14zM3 4v6h2V6h14v4h2V4zm8 7v2H8v2l-3-3l3-3v2zm5 0V9l3 3l-3 3v-2h-3v-2z"\n  />\n</svg>\n',tip:"Split Cell",handle:function(t,e){t.splitCell(e),t.hideTableTools()}},DeleteRow:{name:"DeleteRow",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\n  <path\n    fill="currentColor"\n    d="M9.41 13L12 15.59L14.59 13L16 14.41L13.41 17L16 19.59L14.59 21L12 18.41L9.41 21L8 19.59L10.59 17L8 14.41zM22 9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2zM4 9h4V6H4zm6 0h4V6h-4zm6 0h4V6h-4z"\n  />\n</svg>\n',tip:"Delete Row",handle:function(t,e){t.removeRow(e),t.hideTableTools()}},DeleteColumn:{name:"DeleteColumn",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\n  <path\n    fill="currentColor"\n    d="M4 2h7a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m0 8v4h7v-4zm0 6v4h7v-4zM4 4v4h7V4zm13.59 8L15 9.41L16.41 8L19 10.59L21.59 8L23 9.41L20.41 12L23 14.59L21.59 16L19 13.41L16.41 16L15 14.59z"\n  />\n</svg>\n',tip:"Delete Column",handle:function(t,e){t.removeCol(e),t.hideTableTools()}},DeleteTable:{name:"DeleteTable",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\n  <path\n    fill="currentColor"\n    d="m15.46 15.88l1.42-1.42L19 16.59l2.12-2.13l1.42 1.42L20.41 18l2.13 2.12l-1.42 1.42L19 19.41l-2.12 2.13l-1.42-1.42L17.59 18zM4 3h14a2 2 0 0 1 2 2v7.08a6 6 0 0 0-4.32.92H12v4h1.08c-.11.68-.11 1.35 0 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2m0 4v4h6V7zm8 0v4h6V7zm-8 6v4h6v-4z"\n  />\n</svg>\n',tip:"Delete table",handle:function(t,e){t.deleteTable(e)}},BackgroundColor:{name:"BackgroundColor",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\n  <path\n    fill="none"\n    stroke="currentColor"\n    stroke-linecap="round"\n    stroke-linejoin="round"\n    stroke-width="2"\n    d="m4 8l4-4m6 0L4 14m0 6L20 4m0 6L10 20m10-4l-4 4"\n  />\n</svg>\n',isColorChoose:!0,tip:"Set background color",key:"background-color",handle:function(t,e,n){t.setCellAttrs(e,"background-color",n,!0)}},BorderColor:{name:"BorderColor",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\n  <path\n    fill="none"\n    stroke="currentColor"\n    stroke-linecap="round"\n    stroke-linejoin="round"\n    stroke-width="1.5"\n    d="m12.01 16l-.01.011M12.01 12l-.01.011M12.01 8l-.01.011M8.01 12l-.01.011M16.01 12l-.01.011M21 3.6v16.8a.6.6 0 0 1-.6.6H3.6a.6.6 0 0 1-.6-.6V3.6a.6.6 0 0 1 .6-.6h16.8a.6.6 0 0 1 .6.6"\n  />\n</svg>\n',isColorChoose:!0,tip:"Set border color",key:"border-color",handle:function(t,e,n){t.setCellAttrs(e,"border-color",n,!0)}},SwitchWidth:{name:"SwitchWidth",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\n  \x3c!-- Icon from Tabler Icons by Pawe Kuna - https://github.com/tabler/tabler-icons/blob/master/LICENSE --\x3e\n  <path\n    fill="none"\n    stroke="currentColor"\n    stroke-linecap="round"\n    stroke-linejoin="round"\n    stroke-width="2"\n    d="M4 12V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v6m-10 6H3m18 0h-7m-8-3l-3 3l3 3m12-6l3 3l-3 3"\n  />\n</svg>\n',tip:"Switch table width",handle:function(t){if(t.table){var n=e.find(t.table);n&&(n.full?n.cancelFull():n.setFull())}}},InsertCaption:{name:"InsertCaption",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\n  \x3c!-- Icon from TDesign Icons by TDesign - https://github.com/Tencent/tdesign-icons/blob/main/LICENSE --\x3e\n  <path fill="currentColor" d="M21 10v12h-2V12H5v10H3V10zm0-8v6H3V2zm-2 2H5v2h14z" />\n</svg>\n',tip:"Insert table caption",handle:function(t){if(t.table){var n=e.find(t.table);if(n){var i=t.quill.scroll.create("text","Table Caption").wrap(N.tableCaption,{tableId:n.tableId});n.insertBefore(i,n.children.head)}}}}},sn=z("color-map"),cn={selectWrapper:sn.b(),used:sn.bm("used"),item:sn.be("item"),btn:sn.be("btn"),map:sn.be("content"),mapRow:sn.be("content-row")},dn=function(){return s((function t(n,i,o){var r=this;a(this,t),d(this,"tableModule",void 0),d(this,"quill",void 0),d(this,"usedColors",new Set),d(this,"options",void 0),d(this,"menu",null),d(this,"isMenuDisplay",!1),d(this,"isColorPicking",!1),d(this,"updateUsedColor",void 0),d(this,"tooltipItem",[]),d(this,"activeTooltip",null),d(this,"bem",z("menu")),d(this,"colorItemClass","color-".concat(Me())),d(this,"colorChooseTooltipOption",{direction:"top"}),d(this,"updateWhenTextChange",(function(){r.isMenuDisplay&&r.update()})),this.tableModule=n,this.quill=i,this.options=this.resolveOptions(o);try{var l=localStorage.getItem(this.options.localstorageKey)||"[]",s=JSON.parse(l);G(s)||(s=[]),s.slice(-10).map((function(t){return r.usedColors.add(t)}))}catch(t){}this.updateUsedColor=ke((function(t){if(t){if(r.usedColors.add(t),r.usedColors.size>10){var e=Array.from(r.usedColors).slice(-10);r.usedColors.clear(),e.map((function(t){return r.usedColors.add(t)}))}localStorage.setItem(r.options.localstorageKey,JSON.stringify(Array.from(r.usedColors)));for(var n=0,i=Array.from(document.querySelectorAll(".".concat(r.colorItemClass,".").concat(cn.used)));n<i.length;n++){var o=i[n],a=document.createElement("div");a.classList.add(cn.item),a.style.backgroundColor=String(t),Array.from(o.querySelectorAll(".".concat(cn.item,'[style*="background-color: ').concat(a.style.backgroundColor,'"]'))).length<=0&&o.appendChild(a);var l,s=c(Array.from(o.querySelectorAll(".".concat(cn.item))).slice(0,-10));try{for(s.s();!(l=s.n()).done;){l.value.remove()}}catch(t){s.e(t)}finally{s.f()}}}}),1e3),this.quill.on(e.events.TEXT_CHANGE,this.updateWhenTextChange)}),[{key:"resolveOptions",value:function(t){return Object.assign({tipText:!0,tools:[ln.InsertTop,ln.InsertRight,ln.InsertBottom,ln.InsertLeft,ln.Break,ln.MergeCell,ln.SplitCell,ln.Break,ln.DeleteRow,ln.DeleteColumn,ln.DeleteTable,ln.Break,ln.BackgroundColor,ln.BorderColor],localstorageKey:"__table-bg-used-color",defaultColorMap:B},t)}},{key:"buildTools",value:function(){var t=this,e=document.createElement("div");e.classList.add(this.bem.b()),Object.assign(e.style,{display:"flex"});var n,i=c(this.options.tools);try{var o=function(){var i=n.value,o=i.name,r=i.icon,a=i.handle,l=i.isColorChoose,s=i.key,c=i.tip,d=void 0===c?"":c,u=document.createElement("span");if(u.classList.add(t.bem.be("item")),"break"===o)u.classList.add(t.bem.is("break"));else{var h=document.createElement("i");if(h.classList.add("icon"),Y(r)?h.appendChild(r(t.tableModule)):h.innerHTML=r,u.appendChild(h),l&&s){var f=t.createColorChoose(u,{name:o,icon:r,handle:a,isColorChoose:l,key:s,tip:d});t.tooltipItem.push(f),u.classList.add(an)}else Y(a)&&u.addEventListener("click",(function(e){t.quill.focus(),a(t.tableModule,t.getSelectedTds(),e)}),!1);var p=t.tableModule.options.texts[o]||d;t.options.tipText&&p&&d&&t.createTipText(u,p)}e.appendChild(u)};for(i.s();!(n=i.n()).done;)o()}catch(t){i.e(t)}finally{i.f()}return e}},{key:"createColorChoose",value:function(t,e){var n=this,i=e.handle,o=e.key,r=document.createElement("div");if(r.classList.add(cn.selectWrapper),this.options.defaultColorMap.length>0){var a=document.createElement("div");a.classList.add(cn.map);var l,s=c(this.options.defaultColorMap);try{for(s.s();!(l=s.n()).done;){var d=l.value,u=document.createElement("div");u.classList.add(cn.mapRow);var h,f=c(d);try{for(f.s();!(h=f.n()).done;){var p=h.value,v=document.createElement("div");v.classList.add(cn.item),v.style.backgroundColor=p,u.appendChild(v)}}catch(t){f.e(t)}finally{f.f()}a.appendChild(u)}}catch(t){s.e(t)}finally{s.f()}r.appendChild(a)}var m=document.createElement("div");m.classList.add(cn.mapRow),Object.assign(m.style,{marginTop:"4px"});var g=document.createElement("div");g.classList.add(cn.btn,"transparent"),g.textContent=this.tableModule.options.texts.transparent,g.addEventListener("click",(function(){i(n.tableModule,n.getSelectedTds(),"transparent")}));var y=document.createElement("div");y.classList.add(cn.btn,"clear"),y.textContent=this.tableModule.options.texts.clear,y.addEventListener("click",(function(){i(n.tableModule,n.getSelectedTds(),null)}));var w=document.createElement("div");w.classList.add(cn.btn,"custom"),w.textContent=this.tableModule.options.texts.custom;var C=Q({onChange:function(t){i(n.tableModule,n.getSelectedTds(),t),n.updateUsedColor(t)}}),x=pe(w,{direction:"right",type:"click",content:C,container:w}),M=x.hide,k=x.destroy;m.appendChild(g),m.appendChild(y),m.appendChild(w),r.appendChild(m);var I=document.createElement("div");I.classList.add(cn.used,this.colorItemClass);var T,N=c(this.usedColors);try{for(N.s();!(T=N.n()).done;){var E=T.value,S=document.createElement("div");S.classList.add(cn.item),S.style.backgroundColor=E,I.appendChild(S)}}catch(t){N.e(t)}finally{N.f()}r.appendChild(I),r.addEventListener("click",(function(t){t.stopPropagation(),M();var e=t.target,i=e.style.backgroundColor,r=n.getSelectedTds();if(e&&i&&r.length>0){if(n.tableModule.setCellAttrs(r,o,i,!0),!e.closest(".".concat(cn.item)))return;n.updateUsedColor(i)}}));var L=pe(t,b({type:"click",content:r,onOpen:function(){return n.isMenuDisplay&&n.tableModule.tableSelection&&n.tableModule.tableSelection.hideDisplay(),n.setActiveTooltip(L),!1},onClose:function(){return n.isMenuDisplay&&n.tableModule.tableSelection&&(n.tableModule.tableSelection.updateWithSelectedTds(),n.tableModule.tableSelection.showDisplay()),r.contains(C)&&M(),n.activeTooltip===L&&(n.activeTooltip=null),!1},onDestroy:function(){k(),n.activeTooltip===L&&(n.activeTooltip=null)}},this.colorChooseTooltipOption));return L.isColorPick=!0,L}},{key:"setActiveTooltip",value:function(t){this.activeTooltip&&this.activeTooltip!==t&&this.activeTooltip.hide(!0),this.activeTooltip=t}},{key:"getSelectedTds",value:function(){var t;return(null===(t=this.tableModule.tableSelection)||void 0===t?void 0:t.selectedTds)||[]}},{key:"createTipText",value:function(t,e){var n=pe(t,{msg:e});n&&this.tooltipItem.push(n)}},{key:"show",value:function(){this.menu&&this.tableModule.tableSelection&&this.tableModule.tableSelection.boundary&&(Object.assign(this.menu.style,{display:"flex"}),this.isMenuDisplay=!0,this.update())}},{key:"update",value:function(){}},{key:"hide",value:function(){this.menu&&Object.assign(this.menu.style,{display:"none"});var t,e=c(this.tooltipItem);try{for(e.s();!(t=e.n()).done;){t.value.hide(!0)}}catch(t){e.e(t)}finally{e.f()}this.isMenuDisplay=!1}},{key:"destroy",value:function(){this.quill.off(e.events.TEXT_CHANGE,this.updateWhenTextChange),this.activeTooltip=null;var t,n=c(this.tooltipItem);try{for(n.s();!(t=n.n()).done;){t.value.destroy()}}catch(t){n.e(t)}finally{n.f()}this.menu&&(this.hide(),this.menu.remove(),this.menu=null)}}])}(),un=function(t){function e(t,n,i){var o;return a(this,e),d(o=r(this,e,[t,n,i]),"tableModule",void 0),d(o,"quill",void 0),d(o,"colorChooseTooltipOption",{direction:"right"}),d(o,"listenContextmenu",(function(t){var e;t.preventDefault();var n=t.composedPath();!n||n.length<=0||(n.find((function(t){return t.tagName&&"TABLE"===t.tagName.toUpperCase()&&t.classList.contains("ql-table")}))&&null!==(e=o.tableModule.tableSelection)&&void 0!==e&&null!==(e=e.selectedTds)&&void 0!==e&&e.length?(o.menu||(o.menu=o.buildTools()),Object.assign(o.menu.style,{display:"flex"}),o.isMenuDisplay=!0,o.update({x:t.clientX,y:t.clientY}),document.addEventListener("click",(function(){o.hide()}),{once:!0})):o.hide())})),o.tableModule=t,o.quill=n,o.quill.root.addEventListener("contextmenu",o.listenContextmenu),o}return f(e,t),s(e,[{key:"buildTools",value:function(){var t=x(e,"buildTools",this,3)([]);t.classList.add(this.bem.is("contextmenu"));for(var n=t.getElementsByClassName(an),i=0,o=Array.from(n);i<o.length;i++){o[i].addEventListener("click",(function(t){return t.stopPropagation()}))}return document.body.appendChild(t),t}},{key:"createTipText",value:function(t,e){var n=document.createElement("span");n.textContent=e,t.appendChild(n)}},{key:"show",value:function(){}},{key:"update",value:function(t){if(this.isMenuDisplay&&this.menu&&this.tableModule.tableSelection&&this.tableModule.tableSelection.isDisplaySelection&&t){x(e,"update",this,3)([]);var n={display:"flex",left:0,top:0},i=t.x,o=t.y;n.left=i,n.top=o,Object.assign(this.menu.style,b(b({},n),{},{left:"".concat(n.left+window.scrollX,"px"),top:"".concat(n.top+window.scrollY,"px")}));var r=be(this.menu.getBoundingClientRect()),a=r.left,l=r.top;Object.assign(this.menu.style,{left:"".concat(a+window.scrollX,"px"),top:"".concat(l+window.scrollY,"px")})}}},{key:"destroy",value:function(){this.quill.root.removeEventListener("contextmenu",this.listenContextmenu),x(e,"destroy",this,3)([])}}])}(dn),hn=function(t){function e(t,n,i){var o;return a(this,e),d(o=r(this,e,[t,n,i]),"tableModule",void 0),d(o,"quill",void 0),o.tableModule=t,o.quill=n,o.menu=o.buildTools(),o.tableModule.addContainer(o.menu),o.show(),o.update(),o}return f(e,t),s(e,[{key:"update",value:function(){var t=this;this.isMenuDisplay&&this.menu&&this.tableModule.tableSelection&&this.tableModule.tableSelection.isDisplaySelection&&(x(e,"update",this,3)([]),he(this.tableModule.tableSelection.cellSelect,this.menu,{placement:"bottom",middleware:[de(),ce({limiter:ue()}),se(20)]}).then((function(e){var n=e.x,i=e.y;Object.assign(t.menu.style,{left:"".concat(n,"px"),top:"".concat(i,"px")})})))}}])}(dn),fn=function(t){return!t.full&&"right"===t.align},pn=function(){return s((function t(e,n){a(this,t),d(this,"tableModule",void 0),d(this,"quill",void 0),d(this,"colIndex",-1),d(this,"tableMain",void 0),d(this,"dragging",!1),d(this,"dragColBreak",null),d(this,"handleColMouseUpFunc",this.handleColMouseUp.bind(this)),d(this,"handleColMouseMoveFunc",this.handleColMouseMove.bind(this)),d(this,"handleColMouseDownFunc",this.handleColMouseDown.bind(this)),d(this,"rowIndex",-1),d(this,"dragRowBreak",null),d(this,"handleRowMouseUpFunc",this.handleRowMouseUp.bind(this)),d(this,"handleRowMouseMoveFunc",this.handleRowMouseMove.bind(this)),d(this,"handleRowMouseDownFunc",this.handleRowMouseDown.bind(this)),d(this,"dragBEM",z("drag-line")),this.tableModule=e,this.quill=n}),[{key:"findCurrentColIndex",value:function(t){return-1}},{key:"colWidthChange",value:function(t,e,n){}},{key:"createConfirmDialog",value:(e=o(y().mark((function t(e){var n,i,o;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.message,i=e.confirm,o=e.cancel,t.abrupt("return",new Promise((function(t){var e=document.createElement("div");Object.assign(e.style,{padding:"8px 12px",fontSize:"14px",lineHeight:"1.5"});var r=document.createElement("p");r.textContent=n;var a=document.createElement("div");Object.assign(a.style,{display:"flex",justifyContent:"flex-end",gap:"6px"});var l=$({content:o}),s=$({type:"confirm",content:i});a.appendChild(l),a.appendChild(s),e.appendChild(r),e.appendChild(a);var c=tt({child:e}).close;l.addEventListener("click",(function(){t(!1),c()})),s.addEventListener("click",(function(){t(!0),c()}))})));case 2:case"end":return t.stop()}}),t)}))),function(t){return e.apply(this,arguments)})},{key:"handleColMouseUp",value:(t=o(y().mark((function t(){var e,n,i,o,r,a,l,s,d,u,h,f,p,v,b,m,g,w,x,M,k,I,T,N,L,B,R,O,A,z;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.dragColBreak&&this.tableMain&&-1!==this.colIndex){t.next=2;break}return t.abrupt("return");case 2:if(e=this.tableMain.getCols(),n=Number.parseInt(this.dragColBreak.dataset.w||"0"),i=this.tableMain.full,o=!1,r=[],i?(a=this.tableMain.domNode.getBoundingClientRect().width,l=n/a*100,s=e[this.colIndex].width,l<s?(l=Math.max(E.colMinWidthPre,l),e[this.colIndex+1]||e[this.colIndex-1]?(d=e[this.colIndex+1]?this.colIndex+1:this.colIndex-1,r.push({index:d,width:e[d].width+s-l})):l=100,o=!0,r.push({index:this.colIndex,width:l})):e[this.colIndex+1]&&(u=s+e[this.colIndex+1].width,l=Math.min(u-E.colMinWidthPre,l),o=!0,r.push({index:this.colIndex,width:l},{index:this.colIndex+1,width:u-l}))):(this.tableMain.domNode.style.width="".concat(Number.parseFloat(this.tableMain.domNode.style.width)-e[this.colIndex].domNode.getBoundingClientRect().width+n,"px"),o=!0,r.push({index:this.colIndex,width:n})),document.body.removeChild(this.dragColBreak),this.dragColBreak=null,document.removeEventListener("mouseup",this.handleColMouseUpFunc),document.removeEventListener("mousemove",this.handleColMouseMoveFunc),this.dragging=!1,!o){t.next=47;break}if(h=this.tableMain.domNode.getBoundingClientRect().width,!i){t.next=45;break}f=0,p=new Set(r.map((function(t){var e=t.index,n=t.width;return f+=n,e}))),v=c(e.entries()),t.prev=19,v.s();case 21:if((b=v.n()).done){t.next=28;break}if(m=C(b.value,2),g=m[0],w=m[1],!p.has(g)){t.next=25;break}return t.abrupt("continue",26);case 25:f+=w.width;case 26:t.next=21;break;case 28:t.next=33;break;case 30:t.prev=30,t.t0=t.catch(19),v.e(t.t0);case 33:return t.prev=33,v.f(),t.finish(33);case 36:if(!(f>100)){t.next=45;break}return t.next=39,this.createConfirmDialog({message:this.tableModule.options.texts.perWidthInsufficient,confirm:this.tableModule.options.texts.confirmText,cancel:this.tableModule.options.texts.cancelText});case 39:if(t.sent){t.next=41;break}return t.abrupt("return");case 41:this.tableMain.cancelFull(),i=!1,x=c(r.entries());try{for(x.s();!(M=x.n()).done;)k=C(M.value,2),I=k[0],T=k[1],N=T.width,L=T.index,r[I]={index:L,width:N/100*h}}catch(t){x.e(t)}finally{x.f()}case 45:B=c(r);try{for(B.s();!(R=B.n()).done;)O=R.value,A=O.index,z=O.width,e[A].width="".concat(Math.round(z)).concat(i?"%":"px"),this.colWidthChange(A,{px:Math.round(z/100*h),pre:Math.round(z)},i)}catch(t){B.e(t)}finally{B.f()}case 47:this.quill.emitter.emit(S.AFTER_TABLE_RESIZE);case 48:case"end":return t.stop()}}),t,this,[[19,30,33,36]])}))),function(){return t.apply(this,arguments)})},{key:"handleColMouseMove",value:function(t){if(t.preventDefault(),this.dragColBreak&&this.tableMain&&-1!==this.colIndex){var e=this.tableMain.getCols(),n=e[this.colIndex].domNode.getBoundingClientRect(),i=this.tableMain.domNode.getBoundingClientRect(),o=t.clientX;if(this.tableMain.full){var r=E.colMinWidthPre/100*i.width,a=i.right;o>n.right&&e[this.colIndex+1]&&(a=Math.max(e[this.colIndex+1].domNode.getBoundingClientRect().right-r,n.left+r));var l=n.x+r;o=Math.min(Math.max(o,l),a)}else fn(this.tableMain)?n.right-o<E.colMinWidthPx&&(o=n.right-E.colMinWidthPx):o-n.x<E.colMinWidthPx&&(o=n.x+E.colMinWidthPx);var s=o-n.x;return fn(this.tableMain)&&(s=n.right-o),this.dragColBreak.style.left="".concat(o,"px"),this.dragColBreak.dataset.w=String(s),{left:o,width:s}}}},{key:"handleColMouseDown",value:function(t){if(0===t.button&&(t.preventDefault(),this.tableMain)){var e=Ze(this.tableMain),n=e.rect;if(e.body){var i=this.tableMain.getCols();if(this.colIndex=this.findCurrentColIndex(t),-1!==this.colIndex){var o=i[this.colIndex].width,r=this.tableMain.full?o/100*n.width:o;document.addEventListener("mouseup",this.handleColMouseUpFunc),document.addEventListener("mousemove",this.handleColMouseMoveFunc),this.dragging=!0;var a=document.createElement("div");a.classList.add(this.dragBEM.b()),a.classList.add(this.dragBEM.is("col")),a.dataset.w=String(r);var l={top:n.y,left:t.clientX,height:n.height};Object.assign(a.style,{top:"".concat(l.top,"px"),left:"".concat(l.left,"px"),height:"".concat(l.height,"px")});var s=document.body;return s.appendChild(a),this.dragColBreak&&s.removeChild(this.dragColBreak),this.dragColBreak=a,l}}}}},{key:"findCurrentRowIndex",value:function(t){return-1}},{key:"rowHeightChange",value:function(t,e){}},{key:"handleRowMouseUp",value:function(){if(this.tableMain&&this.dragRowBreak&&-1!==this.rowIndex){var t=Number.parseInt(this.dragRowBreak.dataset.h||"0");this.tableMain.getRows()[this.rowIndex].setHeight("".concat(t,"px")),this.rowHeightChange(this.rowIndex,t),document.body.removeChild(this.dragRowBreak),this.dragRowBreak=null,document.removeEventListener("mouseup",this.handleRowMouseUpFunc),document.removeEventListener("mousemove",this.handleRowMouseMoveFunc),this.dragging=!1,this.quill.emitter.emit(S.AFTER_TABLE_RESIZE)}}},{key:"handleRowMouseMove",value:function(t){if(this.tableMain&&this.dragRowBreak&&-1!==this.rowIndex){t.preventDefault();var e=this.tableMain.getRows()[this.rowIndex].domNode.getBoundingClientRect(),n=t.clientY;return n-e.y<E.rowMinHeightPx&&(n=e.y+E.rowMinHeightPx),this.dragRowBreak.style.top="".concat(n,"px"),this.dragRowBreak.dataset.h=String(n-e.y),{top:n,height:n-e.y}}}},{key:"handleRowMouseDown",value:function(t){if(0===t.button&&(t.preventDefault(),this.tableMain&&(this.rowIndex=this.findCurrentRowIndex(t),-1!==this.rowIndex))){this.dragging=!0,document.addEventListener("mouseup",this.handleRowMouseUpFunc),document.addEventListener("mousemove",this.handleRowMouseMoveFunc);var e=this.tableMain.getRows()[this.rowIndex].domNode.getBoundingClientRect().height,n=this.tableMain.domNode.getBoundingClientRect(),i=document.createElement("div");i.classList.add(this.dragBEM.b()),i.classList.add(this.dragBEM.is("row")),i.dataset.h=String(e);var o={top:t.clientY,left:n.x,width:n.width};Object.assign(i.style,{top:"".concat(o.top,"px"),left:"".concat(o.left,"px"),width:"".concat(o.width,"px")});var r=document.body;return r.appendChild(i),this.dragRowBreak&&r.removeChild(this.dragRowBreak),this.dragRowBreak=i,o}}},{key:"update",value:function(){}},{key:"destroy",value:function(){}}]);var t,e}(),vn=function(t){function n(t,i,o){var l;return a(this,n),d(l=r(this,n,[t,o]),"tableModule",void 0),d(l,"table",void 0),d(l,"root",void 0),d(l,"tableMain",void 0),d(l,"tableWrapper",void 0),d(l,"resizeObserver",void 0),d(l,"tableCols",[]),d(l,"tableRows",[]),d(l,"rowHeadWrapper",null),d(l,"colHeadWrapper",null),d(l,"corner",null),d(l,"scrollHandler",[]),d(l,"lastHeaderSelect",null),d(l,"size",12),d(l,"bem",z("resize-box")),d(l,"updateWhenTextChange",(function(){l.update()})),d(l,"handleColMouseDownFunc",function(t){var e=this.handleColMouseDown(t);if(e&&this.dragColBreak){var n=C(D(this.tableMain,_e),1)[0],i=n&&"top"===n.side?0:this.size;Object.assign(this.dragColBreak.style,{top:"".concat(e.top-i,"px"),left:"".concat(e.left,"px"),height:"".concat(e.height+this.size,"px")})}return e}.bind(l)),d(l,"handleRowMouseDownFunc",function(t){var e=this.handleRowMouseDown(t);return e&&this.dragRowBreak&&Object.assign(this.dragRowBreak.style,{top:"".concat(e.top,"px"),left:"".concat(e.left-this.size,"px"),width:"".concat(e.width+this.size,"px")}),e}.bind(l)),l.tableModule=t,l.table=i,l.tableMain=e.find(l.table),l.tableMain?(l.tableWrapper=l.tableMain.parent,l.tableWrapper?(l.root=l.tableModule.addContainer(l.bem.b()),l.resizeObserver=new ResizeObserver((function(){l.show()})),l.resizeObserver.observe(l.table),l.quill.on(e.events.TEXT_CHANGE,l.updateWhenTextChange),l):g(l)):g(l)}return f(n,t),s(n,[{key:"handleResizerHeader",value:function(t,e,n){var i=n.clientX,o=n.clientY,r=this.table.getBoundingClientRect();if(this.tableModule.tableSelection){var a=this.tableModule.tableSelection;n.shiftKey||(this.lastHeaderSelect=null);var l=[{x:t?r.left:i,y:t?o:r.top},{x:t?r.right:i,y:t?o:r.bottom}];if(this.lastHeaderSelect){var s,c;if(this.lastHeaderSelect.isX){var d=Array.from(this.root.getElementsByClassName(this.bem.be("row-header")))[this.lastHeaderSelect.index].getBoundingClientRect();s=Math.min(d.left,r.left),c=d.top+d.height/2}else{var u=Array.from(this.root.getElementsByClassName(this.bem.be("col-header")))[this.lastHeaderSelect.index].getBoundingClientRect();s=u.left+u.width/2,c=Math.min(u.top,r.top)}this.lastHeaderSelect.isX!==t?(l[1]={x:Math.max(l[0].x,s),y:Math.max(l[0].y,c)},l[0]={x:Math.min(l[0].x,s),y:Math.min(l[0].y,c)}):t?(l[0].y=Math.min(l[0].y,c),l[1].y=Math.max(l[1].y,c)):(l[0].x=Math.min(l[0].x,s),l[1].x=Math.max(l[1].x,s))}else this.lastHeaderSelect={isX:t,index:e};a.table=this.table,a.selectedTds=a.computeSelectedTds.apply(a,l),a.show()}}},{key:"findCurrentColIndex",value:function(t){return Array.from(this.root.getElementsByClassName(this.bem.be("col-separator"))).indexOf(t.target)}},{key:"colWidthChange",value:function(t,e,n){Array.from(this.root.getElementsByClassName(this.bem.be("col-header")))[t].style.width=n?"".concat(e.pre,"%"):"".concat(e.px,"px")}},{key:"bindColEvents",value:function(){var t=this,e=Array.from(this.root.getElementsByClassName(this.bem.be("col-header"))),n=Array.from(this.root.getElementsByClassName(this.bem.be("col-separator")));ge.call(this,this.tableWrapper.domNode,(function(){t.colHeadWrapper.scrollLeft=t.tableWrapper.domNode.scrollLeft}));var i,o=c(e.entries());try{for(o.s();!(i=o.n()).done;){var r=C(i.value,2),a=r[0];r[1].addEventListener("click",this.handleResizerHeader.bind(this,!1,a))}}catch(t){o.e(t)}finally{o.f()}for(var l=0,s=n;l<s.length;l++){var d=s[l];d.addEventListener("mousedown",this.handleColMouseDownFunc),d.addEventListener("dragstart",(function(t){return t.preventDefault()}))}}},{key:"findCurrentRowIndex",value:function(t){return Array.from(this.root.getElementsByClassName(this.bem.be("row-separator"))).indexOf(t.target)}},{key:"rowHeightChange",value:function(t,e){Array.from(this.root.getElementsByClassName(this.bem.be("row-header")))[t].style.height="".concat(e,"px")}},{key:"bindRowEvents",value:function(){var t=this,e=Array.from(this.root.getElementsByClassName(this.bem.be("row-header"))),n=Array.from(this.root.getElementsByClassName(this.bem.be("row-separator")));ge.call(this,this.tableWrapper.domNode,(function(){t.rowHeadWrapper.scrollTop=t.tableWrapper.domNode.scrollTop}));var i,o=c(e.entries());try{for(o.s();!(i=o.n()).done;){var r=C(i.value,2),a=r[0];r[1].addEventListener("click",this.handleResizerHeader.bind(this,!0,a))}}catch(t){o.e(t)}finally{o.f()}for(var l=0,s=n;l<s.length;l++){var d=s[l];d.addEventListener("mousedown",this.handleRowMouseDownFunc),d.addEventListener("dragstart",(function(t){return t.preventDefault()}))}}},{key:"update",value:function(){var t=Ze(this.tableMain),e=t.rect;if(t.body){var n=this.tableWrapper.domNode.getBoundingClientRect(),i=this.quill.root.getBoundingClientRect();Object.assign(this.root.style,{top:"".concat(Math.max(e.y,n.y)-i.y,"px"),left:"".concat(Math.max(e.x,n.x)-i.x,"px")});var o=-1*this.size,r=-1*this.size;fn(this.tableMain)?(this.root.classList.add(this.bem.is("align-right")),o=Math.min(n.width,e.width),r=Math.min(n.width,e.width)):this.root.classList.remove(this.bem.is("align-right"));var a=C(D(this.tableMain,_e),1)[0],l=!a||!(a&&"top"===a.side);l?this.root.classList.remove(this.bem.is("caption-bottom")):this.root.classList.add(this.bem.is("caption-bottom")),this.corner&&Object.assign(this.corner.style,{transform:"translateY(".concat(-1*this.size,"px) translateX(").concat(o,"px)"),top:"".concat(l?0:e.height+this.size,"px")}),this.rowHeadWrapper&&Object.assign(this.rowHeadWrapper.style,{transform:"translateX(".concat(r,"px)")}),this.colHeadWrapper&&Object.assign(this.colHeadWrapper.style,{top:"".concat(l?0:e.height+this.size,"px")})}}},{key:"show",value:function(){var t=this;this.tableCols=this.tableMain.getCols(),this.tableRows=this.tableMain.getRows(),this.root.innerHTML="";var e=Ze(this.tableMain),n=e.rect;if(e.body){var i=this.tableWrapper.domNode.getBoundingClientRect();if(this.tableCols.length>0&&this.tableRows.length>0&&(this.corner=document.createElement("div"),this.corner.classList.add(this.bem.be("corner")),Object.assign(this.corner.style,{width:"".concat(this.size,"px"),height:"".concat(this.size,"px")}),this.corner.addEventListener("click",(function(){if(t.tableModule.tableSelection){var e=t.tableMain.descendants(Oe),n=t.tableModule.tableSelection;n.selectedTds=e,n.show(),n.updateWithSelectedTds()}})),this.root.appendChild(this.corner)),this.tableCols.length>0){var o,r="",a=c(this.tableCols.entries());try{for(a.s();!(o=a.n()).done;){var l=C(o.value,2)[1].domNode.getBoundingClientRect().width;r+='<div class="'.concat(this.bem.be("col-header"),'" style="width: ').concat(l,'px">\n          <div class="').concat(this.bem.be("col-separator"),'" style="height: ').concat(n.height+this.size-3,'px"></div>\n        </div>')}}catch(t){a.e(t)}finally{a.f()}var s=document.createElement("div");s.classList.add(this.bem.be("col"));var d=document.createElement("div");d.classList.add(this.bem.be("col-wrapper")),Object.assign(s.style,{transform:"translateY(-".concat(this.size,"px)"),maxWidth:"".concat(i.width,"px"),height:"".concat(this.size,"px")}),Object.assign(d.style,{width:"".concat(n.width,"px")}),d.innerHTML=r,s.appendChild(d),this.root.appendChild(s),s.scrollLeft=this.tableWrapper.domNode.scrollLeft,this.colHeadWrapper=s,this.bindColEvents()}if(this.tableRows.length>0){var u,h="",f=c(this.tableRows.entries());try{for(f.s();!(u=f.n()).done;){var p=C(u.value,2)[1],v="".concat(p.domNode.getBoundingClientRect().height,"px");h+='<div class="'.concat(this.bem.be("row-header"),'" style="height: ').concat(Number.parseFloat(v),'px">\n          <div class="').concat(this.bem.be("row-separator"),'" style="width: ').concat(n.width+this.size-3,'px"></div>\n        </div>')}}catch(t){f.e(t)}finally{f.f()}var b=document.createElement("div");b.classList.add(this.bem.be("row"));var m=document.createElement("div");m.classList.add(this.bem.be("row-wrapper")),Object.assign(b.style,{transform:"translateX(-".concat(this.size,"px)"),width:"".concat(this.size,"px"),maxHeight:"".concat(i.height,"px")}),Object.assign(m.style,{height:"".concat(n.height,"px")}),m.innerHTML=h,b.appendChild(m),this.root.appendChild(b),b.scrollTop=this.tableWrapper.domNode.scrollTop,this.rowHeadWrapper=b,this.bindRowEvents()}this.update(),ge.call(this,this.quill.root,(function(){t.update()}))}}},{key:"hide",value:function(){this.root.classList.add(this.bem.is("hidden"))}},{key:"destroy",value:function(){this.hide(),ye.call(this),this.resizeObserver.disconnect(),this.quill.off(e.events.TEXT_CHANGE,this.updateWhenTextChange);var t,n=c(this.scrollHandler);try{for(n.s();!(t=n.n()).done;){var i=C(t.value,2),o=i[0],r=i[1];o.removeEventListener("scroll",r)}}catch(t){n.e(t)}finally{n.f()}this.root.remove()}}])}(pn),bn=function(t){function n(t,i,l){var s;return a(this,n),d(s=r(this,n,[t,l]),"tableModule",void 0),d(s,"table",void 0),d(s,"colResizer",void 0),d(s,"rowResizer",void 0),d(s,"currentTableCell",void 0),d(s,"dragging",!1),d(s,"curColIndex",-1),d(s,"curRowIndex",-1),d(s,"tableCellBlot",void 0),d(s,"bem",z("resize-line")),d(s,"mousemoveHandler",(function(t){if(!(s.dragging||s.tableModule.tableSelection&&s.tableModule.tableSelection.dragging)){var n=s.findTableCell(t);if(!n)return s.hide();var i=e.find(n);i&&s.currentTableCell!==n&&(s.show(),s.currentTableCell=n,s.tableCellBlot=i,s.tableMain=q(i,N.tableMain),s.tableMain.getCols().length>0&&s.updateColResizer(),s.updateRowResizer())}})),d(s,"hideWhenTextChange",(function(){s.hide()})),d(s,"handleColMouseUpFunc",o(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.handleColMouseUp();case 2:this.updateColResizer();case 3:case"end":return t.stop()}}),t,this)}))).bind(s)),d(s,"handleRowMouseUpFunc",function(){this.handleRowMouseUp(),this.updateRowResizer()}.bind(s)),s.tableModule=t,s.table=i,s.colResizer=s.tableModule.addContainer(s.bem.be("col")),s.rowResizer=s.tableModule.addContainer(s.bem.be("row")),s.table.addEventListener("mousemove",s.mousemoveHandler),s.quill.on(e.events.TEXT_CHANGE,s.hideWhenTextChange),s}return f(n,t),s(n,[{key:"findTableCell",value:function(t){var e,n=c(t.composedPath());try{for(n.s();!(e=n.n()).done;){var i=e.value;if(i instanceof HTMLElement&&"TD"===i.tagName)return i;if(i===document.body)return null}}catch(t){n.e(t)}finally{n.f()}return null}},{key:"findCurrentColIndex",value:function(){return this.curColIndex}},{key:"updateColResizer",value:function(){if(this.tableMain&&this.tableCellBlot){var t=this.tableCellBlot;this.tableModule.toolBox.removeChild(this.colResizer),this.colResizer=this.tableModule.addContainer(this.bem.be("col"));var e=C(W(t,[N.tableBody]),1)[0].domNode.getBoundingClientRect(),n=t.domNode.getBoundingClientRect(),i=this.quill.root.getBoundingClientRect(),o=n.right-i.x;fn(this.tableMain)&&(o=n.left-i.x),Object.assign(this.colResizer.style,{top:"".concat(e.y-i.y,"px"),left:"".concat(o,"px"),height:"".concat(e.height,"px")});var r=this.tableMain.getCols();this.curColIndex=r.findIndex((function(e){return e.colId===t.colId})),this.colResizer.addEventListener("mousedown",this.handleColMouseDownFunc),this.colResizer.addEventListener("dragstart",(function(t){t.preventDefault()}))}}},{key:"findCurrentRowIndex",value:function(){return this.curRowIndex}},{key:"updateRowResizer",value:function(){if(this.tableMain&&this.tableCellBlot){var t=this.tableCellBlot;this.tableModule.toolBox.removeChild(this.rowResizer),this.rowResizer=this.tableModule.addContainer(this.bem.be("row"));var e=t.parent;if(e instanceof Ae){var n=C(W(t,[N.tableBody]),1)[0].domNode.getBoundingClientRect(),i=t.domNode.getBoundingClientRect(),o=this.quill.root.getBoundingClientRect();Object.assign(this.rowResizer.style,{top:"".concat(i.bottom-o.y,"px"),left:"".concat(n.x-o.x,"px"),width:"".concat(n.width,"px")});var r=this.tableMain.getRows();this.curRowIndex=r.indexOf(e),this.rowResizer.addEventListener("mousedown",this.handleRowMouseDownFunc),this.rowResizer.addEventListener("dragstart",(function(t){t.preventDefault()}))}}}},{key:"show",value:function(){this.rowResizer.classList.remove(this.bem.is("hidden")),this.colResizer.classList.remove(this.bem.is("hidden"))}},{key:"hide",value:function(){this.currentTableCell=void 0,this.rowResizer.classList.add(this.bem.is("hidden")),this.colResizer.classList.add(this.bem.is("hidden"))}},{key:"update",value:function(){this.updateColResizer(),this.updateRowResizer()}},{key:"destroy",value:function(){this.colResizer.remove(),this.rowResizer.remove(),this.table.removeEventListener("mousemove",this.mousemoveHandler),this.quill.off(e.events.TEXT_CHANGE,this.hideWhenTextChange)}}])}(pn),mn=function(){return s((function t(n,i,o,r){var l=this;a(this,t),d(this,"tableModule",void 0),d(this,"table",void 0),d(this,"quill",void 0),d(this,"scrollHandler",[]),d(this,"tableMainBlot",null),d(this,"tableWrapperBlot",null),d(this,"bem",z("scale")),d(this,"startX",0),d(this,"startY",0),d(this,"offset",6),d(this,"options",void 0),d(this,"root",void 0),d(this,"block",void 0),d(this,"resizeobserver",new ResizeObserver((function(){return l.update()}))),d(this,"updateWhenTextChange",(function(){l.update()})),this.tableModule=n,this.table=i,this.quill=o,this.options=this.resolveOptions(r),this.tableMainBlot=e.find(i),this.tableMainBlot&&!this.tableMainBlot.full&&(this.tableWrapperBlot=this.tableMainBlot.parent,this.buildResizer(),this.show()),this.quill.on(e.events.TEXT_CHANGE,this.updateWhenTextChange)}),[{key:"resolveOptions",value:function(t){return Object.assign({blockSize:12},t)}},{key:"buildResizer",value:function(){var t=this;if(this.tableMainBlot&&this.tableWrapperBlot){this.root=this.tableModule.addContainer(this.bem.b()),this.root.classList.add(this.bem.is("hidden")),this.block=document.createElement("div"),this.block.classList.add(this.bem.be("block")),Object.assign(this.block.style,{width:"".concat(this.options.blockSize,"px"),height:"".concat(this.options.blockSize,"px")}),this.root.appendChild(this.block);var e=[],n=[],i=function(i){if(t.tableMainBlot){var o,r=fn(t.tableMainBlot)?-1:1,a=(i.clientX-t.startX)*r,l=i.clientY-t.startY,s=Math.floor(a/e.length),d=Math.floor(l/n.length),u=c(e);try{for(u.s();!(o=u.n()).done;){var h=o.value,f=h.blot,p=h.width;f.width=Math.max(p+s,E.colMinWidthPx)}}catch(t){u.e(t)}finally{u.f()}var v,b=c(n);try{for(b.s();!(v=b.n()).done;){var m=v.value,g=m.blot,y=m.height;g.setHeight("".concat(Math.max(y+d,E.rowMinHeightPx),"px"))}}catch(t){b.e(t)}finally{b.f()}}},o=function(){e=[],n=[],document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",o)};this.block.addEventListener("mousedown",(function(r){t.tableMainBlot&&!t.isTableOutofEditor()&&(t.startX=r.clientX,t.startY=r.clientY,e=t.tableMainBlot.getCols().map((function(t){return{blot:t,width:Math.floor(t.width)}})),n=t.tableMainBlot.getRows().map((function(t){return{blot:t,height:Math.floor(t.domNode.getBoundingClientRect().height)}})),document.addEventListener("mousemove",i),document.addEventListener("mouseup",o))})),this.block.addEventListener("dragstart",(function(t){return t.preventDefault()})),this.resizeobserver.observe(this.tableMainBlot.domNode),ge.call(this,this.quill.root,(function(){return t.update()})),ge.call(this,this.tableWrapperBlot.domNode,(function(){return t.update()}))}}},{key:"isTableOutofEditor",value:function(){if(!this.tableMainBlot||!this.tableWrapperBlot||this.tableMainBlot.full)return!1;var t=this.tableMainBlot.domNode.getBoundingClientRect(),e=this.tableWrapperBlot.domNode.getBoundingClientRect();if(t.width>e.width){var n,i=c(this.tableMainBlot.getCols());try{for(i.s();!(n=i.n()).done;){var o=n.value;o.width=Math.floor(o.width/t.width*e.width)}}catch(t){i.e(t)}finally{i.f()}return this.tableMainBlot.colWidthFillTable(),!0}return!1}},{key:"update",value:function(){if(this.block&&this.root&&this.tableMainBlot&&this.tableWrapperBlot)if(this.tableMainBlot.full)this.hide();else{var t=Ze(this.tableMainBlot),e=t.rect;if(t.body){var n=this.tableWrapperBlot.domNode.getBoundingClientRect(),i=this.quill.root.getBoundingClientRect(),o=this.tableWrapperBlot.domNode,r=o.scrollTop,a=o.scrollLeft,l=2*this.options.blockSize+this.offset,s=Math.min(e.width,n.width)+l,c=Math.min(e.height,n.height)+l;Object.assign(this.root.style,{width:"".concat(s,"px"),height:"".concat(c,"px"),left:"".concat(Math.max(e.x,n.x)-i.x-this.options.blockSize,"px"),top:"".concat(Math.max(e.y,n.y)-i.y-this.options.blockSize,"px")});var d={left:"".concat(e.width+l-a,"px"),top:"".concat(c-r,"px")};fn(this.tableMainBlot)?(this.root.classList.add(this.bem.is("align-right")),d.left="".concat(this.options.blockSize+-1*a,"px")):this.root.classList.remove(this.bem.is("align-right")),Object.assign(this.block.style,d)}}}},{key:"show",value:function(){this.root&&(this.root.classList.remove(this.bem.is("hidden")),this.update())}},{key:"hide",value:function(){this.root&&this.root.classList.add(this.bem.is("hidden"))}},{key:"destroy",value:function(){this.hide(),this.quill.off(e.events.TEXT_CHANGE,this.updateWhenTextChange),this.root&&this.root.remove(),ye.call(this)}}])}(),gn=function(){return s((function t(n,i,o,r){var l=this;a(this,t),d(this,"quill",void 0),d(this,"isVertical",void 0),d(this,"table",void 0),d(this,"scrollbarContainer",void 0),d(this,"minSize",20),d(this,"gap",4),d(this,"move",0),d(this,"cursorDown",!1),d(this,"cursorLeave",!1),d(this,"ratioY",1),d(this,"ratioX",1),d(this,"sizeWidth",""),d(this,"sizeHeight",""),d(this,"size",""),d(this,"thumbState",{X:0,Y:0}),d(this,"ob",void 0),d(this,"container",void 0),d(this,"scrollbar",void 0),d(this,"thumb",document.createElement("div")),d(this,"scrollHandler",[]),d(this,"propertyMap",void 0),d(this,"bem",z("scrollbar")),d(this,"tableMainBlot",void 0),d(this,"showScrollbar",ke((function(){l.cursorLeave=!1,l.scrollbar.removeEventListener("transitionend",l.hideScrollbarTransitionend),l.scrollbar.style.display=l.size?"block":"none",requestAnimationFrame((function(){l.scrollbar.classList.remove(l.bem.is("transparent"))}))}),200)),d(this,"hideScrollbar",ke((function(){l.cursorLeave=!0,l.cursorDown||(l.scrollbar.removeEventListener("transitionend",l.hideScrollbarTransitionend),l.scrollbar.addEventListener("transitionend",l.hideScrollbarTransitionend,{once:!0}),l.scrollbar.classList.add(l.bem.is("transparent")))}),200)),d(this,"hideScrollbarTransitionend",(function(){l.scrollbar.style.display=l.cursorDown&&l.size?"block":"none"})),this.quill=n,this.isVertical=i,this.table=o,this.scrollbarContainer=r,this.tableMainBlot=e.find(this.table),this.container=o.parentElement,this.propertyMap=this.isVertical?{size:"height",offset:"offsetHeight",scrollDirection:"scrollTop",scrollSize:"scrollHeight",axis:"Y",direction:"top",client:"clientY"}:{size:"width",offset:"offsetWidth",scrollDirection:"scrollLeft",scrollSize:"scrollWidth",axis:"X",direction:"left",client:"clientX"},this.calculateSize(),this.ob=new ResizeObserver((function(){l.update()})),this.ob.observe(o),this.scrollbar=this.createScrollbar(),this.setScrollbarPosition(),ge.call(this,this.quill.root,(function(){return l.setScrollbarPosition()})),this.showScrollbar()}),[{key:"update",value:function(){this.calculateSize(),this.setScrollbarPosition()}},{key:"setScrollbarPosition",value:function(){var t=Ze(this.tableMainBlot),e=t.rect,n=e.width,i=e.height,o=t.body;if(o){var r=this.quill.root,a=r.scrollLeft,l=r.scrollTop,s=r.offsetLeft,c=r.offsetTop,u=this.container,h=u.offsetLeft,f=u.offsetTop,p=o.domNode,v=p.offsetLeft,b=p.offsetTop,m=this.container.getBoundingClientRect(),g=m.width,y=m.height,w=h+v-s,C=f+b-c;this.isVertical?w+=Math.min(g,n):C+=Math.min(y,i),this.tableMainBlot&&"left"!==this.tableMainBlot.align&&(w+=this.table.offsetLeft-h),Object.assign(this.scrollbar.style,d(d({},this.propertyMap.size,"".concat(this.isVertical?Math.min(y,i):g,"px")),"transform","translate(".concat(w-a,"px, ").concat(C-l,"px)"))),this.containerScrollHandler(this.container)}}},{key:"calculateSize",value:function(){var t=this.container.offsetHeight-this.gap,e=this.container.offsetWidth-this.gap,n=Math.pow(t,2)/this.container.scrollHeight,i=Math.pow(e,2)/this.container.scrollWidth,o=Math.max(n,this.minSize),r=Math.max(i,this.minSize);this.ratioY=n/(t-n)/(o/(t-o)),this.ratioX=i/(e-i)/(r/(e-r)),this.sizeWidth=r+this.gap<e?"".concat(r,"px"):"",this.sizeHeight=o+this.gap<t?"".concat(o,"px"):"",this.size=this.isVertical?this.sizeHeight:this.sizeWidth}},{key:"createScrollbar",value:function(){var t=this,e=document.createElement("div");e.classList.add(this.bem.b()),e.classList.add(this.isVertical?this.bem.is("vertical"):this.bem.is("horizontal"),this.bem.is("transparent")),Object.assign(e.style,{display:"none"}),this.thumb.classList.add(this.bem.be("thumb"));var n=null,i=function(e){if(!1!==t.cursorDown){var n=t.thumbState[t.propertyMap.axis];if(n){var i=Math.pow(t.scrollbar[t.propertyMap.offset],2)/t.container[t.propertyMap.scrollSize]/(t.isVertical?t.ratioY:t.ratioX)/t.thumb[t.propertyMap.offset],o=100*(-1*(t.scrollbar.getBoundingClientRect()[t.propertyMap.direction]-e[t.propertyMap.client])-(t.thumb[t.propertyMap.offset]-n))*i/t.scrollbar[t.propertyMap.offset];t.container[t.propertyMap.scrollDirection]=o*t.container[t.propertyMap.scrollSize]/100}}},o=function(){t.thumbState[t.propertyMap.axis]=0,t.cursorDown=!1,document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",o),t.cursorLeave&&t.hideScrollbar(),document.onselectstart=n};this.thumb.addEventListener("mousedown",(function(e){var r;if(e.stopPropagation(),!e.ctrlKey&&![1,2].includes(e.button)){null===(r=window.getSelection())||void 0===r||r.removeAllRanges(),function(e){e.stopImmediatePropagation(),t.cursorDown=!0,document.addEventListener("mousemove",i),document.addEventListener("mouseup",o),n=document.onselectstart,document.onselectstart=function(){return!1}}(e);var a=e.currentTarget;a&&(t.thumbState[t.propertyMap.axis]=a[t.propertyMap.offset]-(e[t.propertyMap.client]-a.getBoundingClientRect()[t.propertyMap.direction]))}}));for(var r=0,a=[this.table,e];r<a.length;r++){var l=a[r];l.addEventListener("mouseenter",this.showScrollbar),l.addEventListener("mouseleave",this.hideScrollbar)}return ge.call(this,this.container,(function(){t.containerScrollHandler(t.container)})),e.appendChild(this.thumb),e}},{key:"containerScrollHandler",value:function(t){var e=t[this.propertyMap.offset]-this.gap;this.move=100*t[this.propertyMap.scrollDirection]/e*(this.isVertical?this.ratioY:this.ratioX),Object.assign(this.thumb.style,d(d({},this.propertyMap.size,this.size),"transform","translate".concat(this.propertyMap.axis,"(").concat(this.move,"%)")))}},{key:"destroy",value:function(){this.ob.disconnect(),ye.call(this),this.table.removeEventListener("mouseenter",this.showScrollbar),this.table.removeEventListener("mouseleave",this.hideScrollbar)}}])}(),yn=function(){return s((function t(n,i,o){var r=this;a(this,t),d(this,"tableModule",void 0),d(this,"table",void 0),d(this,"quill",void 0),d(this,"scrollbarContainer",void 0),d(this,"scrollbar",void 0),d(this,"bem",z("scrollbar")),d(this,"updateWhenTextChange",(function(){r.update()})),this.tableModule=n,this.table=i,this.quill=o,this.scrollbarContainer=this.tableModule.addContainer(this.bem.be("container")),this.scrollbar=[new gn(o,!0,i,this.scrollbarContainer),new gn(o,!1,i,this.scrollbarContainer)];var l,s=c(this.scrollbar);try{for(s.s();!(l=s.n()).done;){var u=l.value;this.scrollbarContainer.appendChild(u.scrollbar)}}catch(t){s.e(t)}finally{s.f()}this.quill.on(e.events.TEXT_CHANGE,this.updateWhenTextChange)}),[{key:"hide",value:function(){var t,e=c(this.scrollbar);try{for(e.s();!(t=e.n()).done;){t.value.hideScrollbar()}}catch(t){e.e(t)}finally{e.f()}}},{key:"show",value:function(){var t,e=c(this.scrollbar);try{for(e.s();!(t=e.n()).done;){t.value.showScrollbar()}}catch(t){e.e(t)}finally{e.f()}}},{key:"update",value:function(){var t,e=c(this.scrollbar);try{for(e.s();!(t=e.n()).done;){var n=t.value;n.calculateSize(),n.setScrollbarPosition()}}catch(t){e.e(t)}finally{e.f()}}},{key:"destroy",value:function(){this.scrollbarContainer.remove(),this.quill.off(e.events.TEXT_CHANGE,this.updateWhenTextChange);var t,n=c(this.scrollbar);try{for(n.s();!(t=n.n()).done;){t.value.destroy()}}catch(t){n.e(t)}finally{n.f()}}}])}(),wn=function(){return s((function t(n,i){var o=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};a(this,t),d(this,"tableModule",void 0),d(this,"quill",void 0),d(this,"options",void 0),d(this,"boundary",null),d(this,"startScrollX",0),d(this,"startScrollY",0),d(this,"selectedTableScrollX",0),d(this,"selectedTableScrollY",0),d(this,"selectedEditorScrollX",0),d(this,"selectedEditorScrollY",0),d(this,"selectedTds",[]),d(this,"cellSelectWrap",void 0),d(this,"cellSelect",void 0),d(this,"dragging",!1),d(this,"scrollHandler",[]),d(this,"tableMenu",void 0),d(this,"resizeObserver",void 0),d(this,"table",void 0),d(this,"isDisplaySelection",!1),d(this,"bem",z("selection")),d(this,"lastSelection",{anchorNode:null,anchorOffset:0,focusNode:null,focusOffset:0}),d(this,"updateAfterEvent",(function(){o.updateWithSelectedTds()})),d(this,"quillSelectionChangeHandler",(function(t,n,i){if(i!==e.sources.API&&t&&o.selectedTds.length>0){var r=o.quill.getFormat(t),a=C(o.quill.getLine(t.index),1)[0],l=!!r[N.tableCellInner]&&!!a,s=o.selectedTds.some((function(t){return t.children.contains(a)}));if(l&&!s)try{var c=q(a,N.tableCellInner);o.selectedTds=[c],o.updateWithSelectedTds()}catch(t){}else l&&s||o.hide()}})),d(this,"selectionChangeHandler",(function(){var t=window.getSelection();if(t){var n=t.anchorNode,i=t.focusNode,r=t.anchorOffset,a=t.focusOffset;if(n&&i){var l=e.find(n),s=e.find(i);if(l&&s&&l.scroll===o.quill.scroll&&s.scroll===o.quill.scroll){var c=H(l),d=H(s),u=c.has(N.tableColgroup),h=d.has(N.tableColgroup);if(u||h){var f=n,p=r,v=i,b=a;if(u){var m=c.get(N.tableWrapper).descendants(Oe);m.length>0&&(f=m[0].domNode,p=0)}if(h){var g=d.get(N.tableWrapper).descendants(Oe);g.length>0&&(v=g[0].domNode,b=0)}o.setSelectionData(t,{anchorNode:f,anchorOffset:p,focusNode:v,focusOffset:b})}else{var y=c.has(N.tableCellInner),w=d.has(N.tableCellInner),C=y&&w;if(C){var x=c.get(N.tableCellInner),M=d.get(N.tableCellInner);C&&(C=x!==M)}if(y&&w&&C||!y&&w||!w&&y)return o.setSelectionData(t,o.lastSelection),void(o.selectedTds.length>0&&o.hide());o.lastSelection={anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:a}}}}}})),d(this,"mouseDownHandler",(function(t){var e=t.button,n=t.target,i=t.clientX,r=t.clientY,a=n.closest(".ql-table"),l=n.closest("tbody");if(0===e&&a&&l){o.setSelectionTable(a);var s=a.dataset.tableId,c={x:i,y:r};o.selectedTds=o.computeSelectedTds(c,c),o.dragging=!0,o.show();var d=function(t){o.tableMenu&&o.tableMenu.hide(),o.tableModule.tableResize&&o.tableModule.tableResize.hide();var e=t.button,n=t.target,i=t.clientX,r=t.clientY,a=n.closest("tbody");if(0===e&&a&&a.dataset.tableId===s){var l={x:i,y:r};o.selectedTds=o.computeSelectedTds(c,l),o.selectedTds.length>1&&o.quill.blur(),o.update()}},u=function(){document.body.removeEventListener("mousemove",d,!1),document.body.removeEventListener("mouseup",u,!1),o.dragging=!1,o.tableMenu&&o.selectedTds.length>0&&o.tableMenu.show()};document.body.addEventListener("mousemove",d,!1),document.body.addEventListener("mouseup",u,!1)}})),d(this,"removeCell",(function(t){if(!(o.quill.getSelection()||"Backspace"!==t.key&&"Delete"!==t.key)){var n,i=c(o.selectedTds);try{for(i.s();!(n=i.n()).done;){var r=n.value;r.deleteAt(0,r.length()-1)}}catch(t){i.e(t)}finally{i.f()}if(o.table){var a=e.find(o.table),l=a.descendants(Oe);o.selectedTds.length===l.length&&a.remove()}}})),this.tableModule=n,this.quill=i,this.options=this.resolveOptions(r),this.cellSelectWrap=n.addContainer(this.bem.b()),this.cellSelect=this.helpLinesInitial(),this.resizeObserver=me((function(){return o.updateAfterEvent()}),{ignoreFirstBind:!0}),this.resizeObserver.observe(this.quill.root),this.quill.root.addEventListener("mousedown",this.mouseDownHandler,{passive:!1}),document.addEventListener("selectionchange",this.selectionChangeHandler,{passive:!1}),this.quill.on(S.AFTER_TABLE_RESIZE,this.updateAfterEvent),this.quill.on(e.events.SELECTION_CHANGE,this.quillSelectionChangeHandler),this.quill.on(e.events.TEXT_CHANGE,this.updateAfterEvent),this.options.tableMenu&&(this.tableMenu=new this.options.tableMenu(n,i,this.options.tableMenuOptions)),this.hide()}),[{key:"getFirstTextNode",value:function(t){for(var e=0,n=Array.from(t.childNodes);e<n.length;e++){var i=n[e];if(i.nodeType===Node.TEXT_NODE)return i}return t}},{key:"getLastTextNode",value:function(t){for(var e=t.childNodes.length-1;e>=0;e--){var n=t.childNodes[e];if(n.nodeType===Node.TEXT_NODE)return n}return t}},{key:"getNodeTailOffset",value:function(t){var e=document.createRange();return e.selectNodeContents(t),e.collapse(!1),e.startOffset}},{key:"setSelectionData",value:function(t,e){var n=e.anchorNode,i=e.anchorOffset,o=e.focusNode,r=e.focusOffset;if(n&&o){var a=document.createRange(),l=this.selectionDirectionUp(e);l?(a.setStart(n,i),a.setEnd(n,i)):(a.setStart(n,i),a.setEnd(o,r)),t.removeAllRanges(),t.addRange(a),l&&t.extend(o,r)}}},{key:"selectionDirectionUp",value:function(t){var e=t.anchorNode,n=t.anchorOffset,i=t.focusNode,o=t.focusOffset;if(!e||!i)return!1;if(e===i)return n>o;var r=e.compareDocumentPosition(i);return r&Node.DOCUMENT_POSITION_CONTAINS||r&Node.DOCUMENT_POSITION_CONTAINED_BY?!!(r&Node.DOCUMENT_POSITION_FOLLOWING):!!(r&Node.DOCUMENT_POSITION_PRECEDING)}},{key:"findWrapSelection",value:function(t){var e,n=null,i=0,o=null,r=0,a=c(t);try{for(a.s();!(e=a.n()).done;){var l=e.value,s=l.node,d=l.offset;s&&(n&&!this.selectionDirectionUp({anchorNode:n,anchorOffset:i,focusNode:s,focusOffset:d})||(n=s,i=d),o&&!this.selectionDirectionUp({anchorNode:s,anchorOffset:d,focusNode:o,focusOffset:r})||(o=s,r=d))}}catch(t){a.e(t)}finally{a.f()}return{startNode:n,startOffset:i,endNode:o,endOffset:r}}},{key:"resolveOptions",value:function(t){return Object.assign({selectColor:"#0589f340",tableMenuOptions:{}},t)}},{key:"helpLinesInitial",value:function(){this.cellSelectWrap.style.setProperty("--select-color",this.options.selectColor);var t=document.createElement("div");return t.classList.add(this.bem.be("line")),this.cellSelectWrap.appendChild(t),t}},{key:"computeSelectedTds",value:function(t,n){if(!this.table)return[];var i=e.find(this.table);if(!i)return[];var o=i.descendants(ze)[0];if(!o)return[];var r=new Set(o.descendants(Ve).map((function(t,e){return t.index=e,t}))),a=this.getTableViewScroll(),l=a.x,s=a.y,d=this.getQuillViewScroll(),u=d.x,h=d.y;this.selectedTableScrollX=l,this.selectedTableScrollY=s,this.selectedEditorScrollX=u,this.selectedEditorScrollY=h;for(var f,p,v,m=Ze(i).rect,g=t.x-l+this.startScrollX,y=t.y-s+this.startScrollY,w={x:Math.max(m.left,Math.min(n.x,g)),y:Math.max(m.top,Math.min(n.y,y)),x1:Math.min(m.right,Math.max(n.x,g)),y1:Math.min(m.bottom,Math.max(n.y,y))},C=new Set,x=!0;x;){x=!1;var k,I=c(r);try{for(I.s();!(k=I.n()).done;){var T=k.value;T.__rect||(T.__rect=T.domNode.getBoundingClientRect());var N=T.__rect,E=N.x,S=N.y,L=N.right,B=N.bottom;if(ve({x:Math.floor(w.x),y:Math.floor(w.y),x1:Math.floor(w.x1),y1:Math.floor(w.y1)},{x:Math.floor(E),y:Math.floor(S),x1:Math.floor(L),y1:Math.floor(B)},0,0===C.size)){C.add(T),r.delete(T),w={x:Math.min(w.x,E),y:Math.min(w.y,S),x1:Math.max(w.x1,L),y1:Math.max(w.y1,B)},x=!0;break}}}catch(t){I.e(t)}finally{I.f()}}for(var R=0,O=[].concat(M(C),M(r));R<O.length;R++){delete O[R].__rect}return this.boundary=(f=b(b({},w),{},{width:w.x1-w.x,height:w.y1-w.y}),p=this.quill.root,v=p.getBoundingClientRect(),{x:f.x-v.x-p.scrollLeft,y:f.y-v.y-p.scrollTop,x1:f.x-v.x-p.scrollLeft+f.width,y1:f.y-v.y-p.scrollTop+f.height,width:f.width,height:f.height}),Array.from(C).sort((function(t,e){return t.index-e.index})).map((function(t){return delete t.index,t.getCellInner()}))}},{key:"updateWithSelectedTds",value:function(){if(!(this.selectedTds.length<=0)){var t,e={x:1/0,y:1/0},n={x:-1/0,y:-1/0},i=c(this.selectedTds);try{for(i.s();!(t=i.n()).done;){var o=t.value.domNode.getBoundingClientRect();e.x=Math.min(e.x,o.left),e.y=Math.min(e.y,o.top),n.x=Math.max(n.x,o.right),n.y=Math.max(n.y,o.bottom)}}catch(t){i.e(t)}finally{i.f()}this.selectedTds=this.computeSelectedTds(e,n),this.selectedTds.length>0?this.update():this.hide()}}},{key:"update",value:function(){if(0!==this.selectedTds.length&&this.boundary&&this.table){var t=this.getQuillViewScroll(),e=t.x,n=t.y,i=this.getTableViewScroll(),o=i.x,r=i.y,a=this.table.parentElement.getBoundingClientRect(),l=this.quill.root.getBoundingClientRect(),s=a.x-l.x,c=a.y-l.y;this.startScrollX=o,this.startScrollY=r,Object.assign(this.cellSelect.style,{left:"".concat(2*this.selectedEditorScrollX-e+this.boundary.x+this.selectedTableScrollX-o-s,"px"),top:"".concat(2*this.selectedEditorScrollY-n+this.boundary.y+this.selectedTableScrollY-r-c,"px"),width:"".concat(this.boundary.width,"px"),height:"".concat(this.boundary.height,"px")}),Object.assign(this.cellSelectWrap.style,{left:"".concat(s,"px"),top:"".concat(c,"px"),width:"".concat(a.width,"px"),height:"".concat(a.height,"px")}),!this.dragging&&this.tableMenu&&this.tableMenu.update()}}},{key:"getQuillViewScroll",value:function(){return{x:this.quill.root.scrollLeft,y:this.quill.root.scrollTop}}},{key:"getTableViewScroll",value:function(){return this.table?{x:this.table.parentElement.scrollLeft,y:this.table.parentElement.scrollTop}:{x:0,y:0}}},{key:"setSelectionTable",value:function(t){this.table!==t&&(this.table=t)}},{key:"showDisplay",value:function(){Object.assign(this.cellSelectWrap.style,{display:"block"}),this.isDisplaySelection=!0,this.table&&this.resizeObserver.observe(this.table)}},{key:"show",value:function(){var t=this;this.table&&(ye.call(this),this.update(),this.showDisplay(),document.addEventListener("keydown",this.removeCell),ge.call(this,this.quill.root,(function(){t.update()})),ge.call(this,this.table.parentElement,(function(){t.update()})))}},{key:"hideDisplay",value:function(){Object.assign(this.cellSelectWrap.style,{display:"none"}),this.isDisplaySelection=!1,this.table&&this.resizeObserver.unobserve(this.table)}},{key:"hide",value:function(){ye.call(this),document.removeEventListener("keydown",this.removeCell),this.hideDisplay(),this.boundary=null,this.selectedTds=[],this.setSelectionTable(void 0),this.tableMenu&&this.tableMenu.hide()}},{key:"destroy",value:function(){this.resizeObserver.disconnect(),this.hide(),this.cellSelectWrap.remove(),this.tableMenu&&this.tableMenu.destroy(),ye.call(this),this.quill.root.removeEventListener("mousedown",this.mouseDownHandler),document.removeEventListener("selectionchange",this.selectionChangeHandler),this.quill.off(e.events.SELECTION_CHANGE,this.quillSelectionChangeHandler),this.quill.off(e.events.TEXT_CHANGE,this.updateAfterEvent),this.quill.on(S.AFTER_TABLE_RESIZE,this.updateAfterEvent)}}])}(),Cn=["attributes"],xn=["style"],Mn=e.import("parchment"),kn=e.import("delta"),In=e.import("blots/break"),Tn=e.import("ui/icons");function Nn(t){return{bindInHead:!1,key:t?"ArrowUp":"ArrowDown",collapsed:!0,format:[N.tableCellInner],handler:function(n,i){var o,r,a,l;try{var s=C(W(i.line,[N.tableWrapper,N.tableMain,N.tableRow,N.tableCell]),4);o=s[0],r=s[1],a=s[2],l=s[3]}catch(t){return!0}var c,d=r.getColIds(),u=t?"prev":"next",h=t?"tail":"head",f=o.descendants(_e,0)[0];if(f){var p=window.getComputedStyle(f.domNode);c="next"===u&&"bottom"===p.captionSide?f:"next"===u?o.next:f}else c=o[u];if(i.line[u]||!c)return!0;var v=a[u];if(v){var b=d.indexOf(l.colId),m=v.getCellByColId(d[b],u);if(!m)return!0;var g=m.children[h];g.children&&(g=g.children[h]);var y=g.offset(this.quill.scroll)+Math.min(i.offset,g.length()-1);this.quill.setSelection(y,0,e.sources.USER)}else{var w=c.offset(this.quill.scroll)+(t?c.length()-1:0);this.quill.setSelection(w,0,e.sources.USER)}return!1}}}var En=function(){return s((function t(e,n){var i=this;if(a(this,t),d(this,"quill",void 0),d(this,"options",void 0),d(this,"toolBox",void 0),d(this,"fixTableByLisenter",ke(this.balanceTables,100)),d(this,"selector",void 0),d(this,"table",void 0),d(this,"tableSelection",void 0),d(this,"tableResize",void 0),d(this,"tableScrollbar",void 0),d(this,"tableAlign",void 0),d(this,"tableResizeScale",void 0),this.quill=e,this.options=this.resolveOptions(n||{}),this.toolBox=this.initialContainer(),!this.options.scrollbar){var o=z("scrollbar");this.quill.container.classList.add(o.bm("origin"))}this.options.selection&&(this.tableSelection=new this.options.selection(this,this.quill,this.options.selectionOptions));var r=this.quill.getModule("toolbar");if(r&&this.quill.theme.pickers){var l=(r.controls||[]).find((function(t){return C(t,1)[0]===i.statics.toolName}))||[],s=C(l,2)[1];if(s&&"select"===s.tagName.toLocaleLowerCase()){var c=this.quill.theme.pickers.find((function(t){return t.select===s}));c&&(c.label.innerHTML=this.options.icon,this.buildCustomSelect(this.options.customSelect,c),c.label.addEventListener("mousedown",(function(){if(i.selector&&c)if(be(i.selector.getBoundingClientRect()).leftLimited){var t=c.label.getBoundingClientRect();Object.assign(c.options.style,{transform:"translateX(calc(-100% + ".concat(t.width,"px))")})}else Object.assign(c.options.style,{transform:void 0})})))}}for(var u=this.quill.getModule("keyboard"),h=0,f=Object.values(t.keyboradHandler);h<f.length;h++){var p=f[h];p.bindInHead?u.bindings[p.key].unshift(p):u.addBinding(p.key,p)}this.quill.root.addEventListener("click",(function(t){var e=t.composedPath();if(e&&!(e.length<=0)){var n=e.find((function(t){return t.tagName&&"TABLE"===t.tagName.toUpperCase()&&t.classList.contains("ql-table")}));if(n){if(i.table===n)return i.tableSelection&&i.tableSelection.show(),i.tableAlign&&i.tableAlign.update(),i.tableResize&&i.tableResize.update(),void(i.tableScrollbar&&i.tableScrollbar.update());i.table&&i.hideTableTools(),i.showTableTools(n)}else i.table&&i.hideTableTools()}}),!1),this.quillHack(),this.listenBalanceCells()}),[{key:"statics",get:function(){return this.constructor}},{key:"initialContainer",value:function(){var t=z("toolbox"),e=this.quill.addContainer(t.b()),n=this.quill.root.getBoundingClientRect(),i=this.quill.root,o=i.offsetLeft,r=i.offsetTop;return Object.assign(e.style,{top:"".concat(r,"px"),left:"".concat(o,"px"),width:"".concat(n.width,"px"),height:"".concat(n.height,"px")}),e}},{key:"addContainer",value:function(t){if(K(t)){var e,n=document.createElement("div"),i=c(t.split(" "));try{for(i.s();!(e=i.n()).done;){var o=e.value;n.classList.add(o)}}catch(t){i.e(t)}finally{i.f()}return this.toolBox.appendChild(n),n}return this.toolBox.appendChild(t),t}},{key:"resolveOptions",value:function(t){return Object.assign({customBtn:!1,texts:this.resolveTexts(t.texts||{}),full:!1,fullSwitch:!0,icon:Tn.table,selectionOptions:{},alignOptions:{},scrollbarOptions:{},resizeOptions:{},resizeScaleOptions:{}},t)}},{key:"resolveTexts",value:function(t){return Object.assign({fullCheckboxText:"Insert full width table",customBtnText:"Custom",confirmText:"Confirm",cancelText:"Cancel",rowText:"Row",colText:"Column",notPositiveNumberError:"Please enter a positive integer",custom:"Custom",clear:"Clear",transparent:"Transparent",perWidthInsufficient:"The percentage width is insufficient. To complete the operation, the table needs to be converted to a fixed width. Do you want to continue?",CopyCell:"Copy cell",CutCell:"Cut cell",InsertTop:"Insert row above",InsertRight:"Insert column right",InsertBottom:"Insert row below",InsertLeft:"Insert column Left",MergeCell:"Merge Cell",SplitCell:"Split Cell",DeleteRow:"Delete Row",DeleteColumn:"Delete Column",DeleteTable:"Delete table",BackgroundColor:"Set background color",BorderColor:"Set border color"},t)}},{key:"quillHack",value:function(){var t=this,n=this.quill.getSemanticHTML;this.quill.getSemanticHTML=function(){for(var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1?arguments[1]:void 0,r=n.call(t.quill,i,o),a=e.import("formats/".concat(N.tableWrapper)),l=(new DOMParser).parseFromString(r,"text/html"),s=0,c=Array.from(l.querySelectorAll(".".concat(a.className," caption[contenteditable], .").concat(a.className," td > [contenteditable]")));s<c.length;s++){c[s].removeAttribute("contenteditable")}return l.body.innerHTML};var i=this.quill.format;this.quill.format=function(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.sources.API;if(!(this.scroll.query(t).prototype instanceof Mn.EmbedBlot)){var r=this.getModule(L.moduleName),a=this.getSelection();if(a&&a.length>0)if(this.getFormat(a)[N.tableCellInner])return i.call(this,t,n,o);if(r&&r.tableSelection&&r.tableSelection.selectedTds.length>0){var l,s=!1,u=[],h=c(r.tableSelection.selectedTds);try{for(h.s();!(l=h.n()).done;){var f=l.value,p=f.offset(this.scroll),v=f.length();u.push({index:p,length:v}),this.getFormat(p,v)[t]!==n&&(s=!0)}}catch(t){h.e(t)}finally{h.f()}var b,m=!!s&&n,g=new kn,y=c(u.entries());try{for(y.s();!(b=y.n()).done;){var w=C(b.value,2),x=w[0],M=w[1],k=M.index,I=M.length,T=0===x?0:u[x-1].index+u[x-1].length;g.retain(k-T).retain(I,d({},t,m))}}catch(t){y.e(t)}finally{y.f()}var E=this.updateContents(g,o);return this.blur(),E}}return i.call(this,t,n,o)};var o=this.quill.theme.modules.toolbar;if(o){var r,a=null===(r=o.handlers)||void 0===r?void 0:r.clean;if(a){var l=function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return""},o=t.quill.getText(e,n),r=C(t.quill.getLine(e+n),2),a=r[0],l=r[1],s=0,c=new kn;null!=a&&(s=a.length()-l,c=a.delta().slice(l,l+s-1).insert("\n"));var u=t.quill.getContents(e,n+s),h=u.diff((new kn).insert(o).concat(c)),f=0,p=h.ops.map((function(t){var e=t.attributes,n=m(t,Cn);if(t.insert?f-=K(t.insert)?t.insert.length:1:t.retain?f+="number"==typeof t.retain?t.retain:1:t.delete&&(f+=t.delete),e){var o=N.tableCellInner;e[o];var r=m(e,[o].map(k));if(i){var a=u.slice(f-1,f).ops[0];if(a&&a.attributes&&a.attributes[N.tableCellInner]){var l=a.attributes[N.tableCellInner],s=l.style,c=m(l,xn),h=i(s);return b(b({},n),{},h?{attributes:b(b({},r),{},d({},N.tableCellInner,b({style:h},c)))}:{attributes:b(b({},r),{},d({},N.tableCellInner,c))})}}return b(b({},n),{},{attributes:b({},r)})}return t}));return new kn(p)};o.handlers.clean=function(t){var n=this,i=this.quill.getModule(L.moduleName),o=this.quill.getSelection();if(o&&o.length>0&&this.quill.getFormat(o)[N.tableCellInner]){var r=l(o.index,o.length,!1),s=(new kn).retain(o.index).concat(r);return void this.quill.updateContents(s,e.sources.USER)}if(i&&i.tableSelection&&i.tableSelection.selectedTds.length>0&&i.tableSelection.table){var d=e.find(i.tableSelection.table);if(!d)return void console.warn("TableMainFormat not found");var u,h=i.tableSelection.selectedTds,f=new Set,p=[],v=c(h);try{for(v.s();!(u=v.n()).done;){var b=u.value;if(b.parent instanceof Ve){var m,g=c(b.parent.getNearByCell("top"));try{for(g.s();!(m=g.n()).done;){var y=m.value;f.has(y)||(f.add(y),p.push({td:y,cleanBorder:"bottom"}))}}catch(t){g.e(t)}finally{g.f()}var w,C=c(b.parent.getNearByCell("left"));try{for(C.s();!(w=C.n()).done;){var x=w.value;f.has(x)||(f.add(x),p.push({td:x,cleanBorder:"right"}))}}catch(t){C.e(t)}finally{C.f()}f.add(b.parent),p.push({td:b.parent,cleanBorder:!0})}}}catch(t){v.e(t)}finally{v.f()}var M=d.descendants(Ve),k=new Map(M.map((function(t,e){return[t,e]})));p.sort((function(t,e){return k.get(t.td)-k.get(e.td)}));for(var I=new kn,T=0,E=function(){var t=B[S],e=t.td,i=t.cleanBorder,o=e.getCellInner().offset(n.quill.scroll),r=e.getCellInner().length(),a=l(o,r-1,(function(t){if(!t||!0===i)return"";var e=we(t);return Ce(Object.keys(e).filter((function(t){return!t.startsWith(xe("border-".concat(i)))})).reduce((function(t,n){return t[n]=e[n],t}),{}))})),s=(new kn).retain(o-T).concat(a);I=I.concat(s),T=o+r},S=0,B=p;S<B.length;S++)E();return this.quill.updateContents(I,e.sources.USER),void(h.length>1&&this.quill.blur())}return a.call(this,t)}}}}},{key:"showTableTools",value:function(t){var e;t&&(this.table=t,null===(e=this.tableSelection)||void 0===e||e.show(),this.options.align&&(this.tableAlign=new this.options.align(this,t,this.quill,this.options.alignOptions)),this.options.scrollbar&&(this.tableScrollbar=new this.options.scrollbar(this,t,this.quill,this.options.scrollbarOptions)),this.options.resize&&(this.tableResize=new this.options.resize(this,t,this.quill,this.options.resizeOptions)),this.options.resizeScale&&(this.tableResizeScale=new this.options.resizeScale(this,t,this.quill,this.options.resizeScaleOptions)))}},{key:"hideTableTools",value:function(){var t;null===(t=this.tableSelection)||void 0===t||t.hide(),this.tableScrollbar&&(this.tableScrollbar.destroy(),this.tableScrollbar=void 0),this.tableAlign&&(this.tableAlign.destroy(),this.tableAlign=void 0),this.tableResize&&(this.tableResize.destroy(),this.tableResize=void 0),this.tableResizeScale&&this.tableResizeScale.destroy(),this.table=void 0}},{key:"buildCustomSelect",value:(t=o(y().mark((function t(e,n){var i,o,r,a,l,s=this;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&Y(e)){t.next=2;break}return t.abrupt("return");case 2:return(i=document.createElement("div")).classList.add("ql-custom-select"),t.next=6,e(this,n);case 6:this.selector=t.sent,i.appendChild(this.selector),this.options.fullSwitch&&(o=z("creator"),(r=document.createElement("label")).classList.add(o.be("checkbox")),(a=document.createElement("input")).type="checkbox",a.checked=this.options.full,a.addEventListener("change",(function(){s.options.full=a.checked})),(l=document.createElement("span")).textContent=this.options.texts.fullCheckboxText,r.appendChild(a),r.appendChild(l),i.appendChild(r)),n.options.innerHTML="",n.options.appendChild(i);case 11:case"end":return t.stop()}}),t,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"setCellAttrs",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(0!==t.length){var o,r=c(t);try{for(r.s();!(o=r.n()).done;){o.value.setFormatValue(e,n,i)}}catch(t){r.e(t)}finally{r.f()}}}},{key:"getTextByCell",value:function(t){var e,n="",i=c(t);try{for(i.s();!(e=i.n()).done;){var o,r=e.value,a=r.offset(this.quill.scroll),l=r.length(),s=c(this.quill.getContents(a,l).ops);try{for(s.s();!(o=s.n()).done;){var d=o.value;K(d.insert)&&(n+=d.insert)}}catch(t){s.e(t)}finally{s.f()}}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"getHTMLByCell",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0===t.length)return"";var n=null;try{var i,o=c(t);try{for(o.s();!(i=o.n()).done;){var r=q(i.value,N.tableMain);if(n||(n=r),r!==n)return console.error("tableMain is not same"),""}}catch(t){o.e(t)}finally{o.f()}}catch(t){return console.error("tds must be in same tableMain"),""}if(!n)return"";var a,l=this.quill.getIndex(n),s=n.length(),d=this.quill.getSemanticHTML(l,s),u=(new DOMParser).parseFromString(d,"text/html"),h=[],f=new Set,p=new Set,v=c(t);try{for(v.s();!(a=v.n()).done;){var b=a.value;f.add(b.colId),p.add("".concat(b.rowId,"-").concat(b.colId))}}catch(t){v.e(t)}finally{v.f()}for(var m=0,g=Array.from(u.querySelectorAll("col"));m<g.length;m++){var y=g[m];f.has(y.dataset.colId)?h.push(y.getAttribute("width")):y.remove()}for(var w=0,x=null,M=0,k=Array.from(u.querySelectorAll("td"));M<k.length;M++){var I=k[M];if(p.has("".concat(I.dataset.rowId,"-").concat(I.dataset.colId)))x!==I.dataset.rowId&&(w+=1,x=I.dataset.rowId);else{var T=I.parentElement;I.remove(),T&&T.children.length<=0&&T.remove()}}var E=Array.from(u.querySelectorAll("col")),S=E.map((function(t){return Xe.value(t)}));if(n.full){var L,B=S.reduce((function(t,e){return e.width+t}),0),R=c(S.entries());try{for(R.s();!(L=R.n()).done;){var O=C(L.value,2),A=O[0],z=O[1];z.width=Math.round(z.width/B*100),E[A].setAttribute("width","".concat(z.width,"%"))}}catch(t){R.e(t)}finally{R.f()}}else{var W,H=0,D=c(S);try{for(D.s();!(W=D.n()).done;){H+=W.value.width}}catch(t){D.e(t)}finally{D.f()}u.querySelector("table").style.width="".concat(H,"px")}if(e)if(w===n.getRows().length)this.removeCol(t);else{var j,P=c(t);try{for(P.s();!(j=P.n()).done;){j.value.domNode.innerHTML="<p><br></p>"}}catch(t){P.e(t)}finally{P.f()}}return u.body.innerHTML}},{key:"insertTable",value:function(t,n){if(t>=30||n>=30)throw new Error("Both rows and columns must be less than 30.");this.quill.focus();var i=this.quill.getSelection();if(null!=i){var o=C(this.quill.getLeaf(i.index),1)[0];if(o){if(A(o))throw new Error("Not supported ".concat(o.statics.blotName," insert into table."));for(var r=this.calculateTableCellBorderWidth(),a=getComputedStyle(this.quill.root),l=Number.parseInt(a.paddingLeft),s=Number.parseInt(a.paddingRight),c=Number.parseInt(a.width)-l-s-r,u=Me(),h=new Array(n).fill(0).map((function(){return Me()})),f=this.options.full?"".concat(Math.max(1/n*100,E.colMinWidthPre),"%"):"".concat(Math.max(Math.floor(c/n),E.colMinWidthPx),"px"),p=[{retain:i.index},{insert:"\n"}],v=0;v<n;v++)p.push({insert:d({},N.tableCol,{width:f,tableId:u,colId:h[v],full:this.options.full})});for(var b=0;b<t;b++)for(var m=Me(),g=0;g<n;g++)p.push({insert:"\n",attributes:d({},N.tableCellInner,{tableId:u,rowId:m,colId:h[g],rowspan:1,colspan:1})});this.quill.updateContents(new kn(p),e.sources.USER),this.quill.setSelection(i.index+n+n*t+1,e.sources.SILENT),this.quill.focus()}}}},{key:"calculateTableCellBorderWidth",value:function(){var t='\n      <table class="'.concat(Ue.className,'">\n        <tbody>\n          <tr>\n            <td class="').concat(Ve.className,'"></td>\n          </tr>\n        </tbody>\n      </table>\n    '),e=document.createElement("div");e.className=Ke.className,e.innerHTML=t,e.style.position="absolute",e.style.left="-9999px",e.style.top="-9999px",e.style.visibility="hidden",this.quill.root.appendChild(e);var n=window.getComputedStyle(e.querySelector("td")),i=Number.parseFloat(n.borderWidth)||0;return this.quill.root.removeChild(e),i}},{key:"fixUnusuaDeletelTable",value:function(t){var e=t.getRows(),n=t.getColIds();if(0===e.length)return t.remove();if(0!==n.length){var i,o,r,a,l,s,d,u=new Array(e.length).fill(0).map((function(){return new Array(n.length).fill(!1)})),h=t.tableId,f=c(e.entries());try{for(f.s();!(i=f.n()).done;){for(var p=C(i.value,2),v=p[0],b=p[1],m=0,g=0,y=u[v],w=b.descendants(Ve);g<n.length;)if(y[g])g+=1;else{var x=w[m];if(x&&x.colId===n[g]){v+x.rowspan-1>=e.length&&(x.getCellInner().rowspan=e.length-v);var M=x.colspan,k=x.rowspan;if(M>1)for(var I=1;I<M;I++)y[g+I]=!0;if(k>1)for(var T=v+1;T<v+k;T++)for(var E=0;E<M;E++)u[T][g+E]=!0;m+=1}else b.insertBefore((o=this.quill.scroll,r={tableId:h,colId:n[g],rowId:b.rowId},a=void 0,l=void 0,s=void 0,d=void 0,a={tableId:r.tableId,rowId:r.rowId,colId:r.colId,colspan:1,rowspan:1},l=o.create(N.tableCell,a),s=o.create(N.tableCellInner,a),(d=o.create("block")).appendChild(o.create("break")),s.appendChild(d),l.appendChild(s),l),x);g+=1}if(m<w.length)for(var S=m;S<w.length;S++)w[S].remove()}}catch(t){f.e(t)}finally{f.f()}}}},{key:"balanceTables",value:function(){var t,e=c(this.quill.scroll.descendants(Ue));try{for(e.s();!(t=e.n()).done;){var n=t.value;this.fixUnusuaDeletelTable(n)}}catch(t){e.e(t)}finally{e.f()}}},{key:"listenBalanceCells",value:function(){var t=this;this.quill.on(e.events.SCROLL_OPTIMIZE,(function(e){e.some((function(e){return!!["TD","TR","TBODY","TABLE"].includes(e.target.tagName)&&(t.fixTableByLisenter(),!0)}))}))}},{key:"deleteTable",value:function(t){if(0!==t.length){var e=q(t[0],N.tableMain);e&&e.remove(),this.hideTableTools()}}},{key:"appendRow",value:function(t,e){if(!(t.length<=0)){var n=t[e?t.length-1:0],i=C(W(n,[N.tableMain,N.tableBody,N.tableRow]),3),o=i[0],r=i[1],a=i[2],l=o.getRows().indexOf(a)+(e?n.rowspan:0);r.insertRow(l)}}},{key:"appendCol",value:function(t,e){if(!(t.length<=0)){var n=t.reduce((function(t,n){var i=n.getColumnIndex();return(!e&&i<=t[1]||e&&i>=t[1])&&(t=[n,i]),t}),[t[0],t[0].getColumnIndex()]),i=C(n,1)[0],o=i.getColumnIndex()+(e?i.colspan:0),r=q(i,N.tableMain),a=r.tableId,l=Me(),s=C(r.descendants(Ye),1)[0];s&&s.insertColByIndex(o,{tableId:a,colId:l,width:r.full?6:160,full:r.full});for(var d=r.getRows(),u=[],h=0,f=0,p=Object.values(d);f<p.length;f++){var v=p[f],b=u.shift()||0;if(h>0)h-=1;else{var m=v.insertCell(o-b,{tableId:a,rowId:v.rowId,colId:l,rowspan:1,colspan:1});m.skipRowNum&&(h+=m.skipRowNum);var g,y=c(m.entries());try{for(y.s();!(g=y.n()).done;){var w=C(g.value,2),x=w[0],M=w[1];u[x]=(u[x]||0)+M}}catch(t){y.e(t)}finally{y.f()}}}}}},{key:"fixTableByRemove",value:function(t){var e,n=t.getRows(),i=t.getCols(),o=i.reduce((function(t,e){return t[e.colId]=0,t}),{}),r=M(n).reverse(),a=[],l=c(r.entries());try{var s=function(){var t=C(e.value,2),i=t[0],r=t[1],l=n.length-i-1;r.children.length<=0?a.push(l):r.foreachCellInner((function(t){var e=a.reduce((function(e,n){return t.rowspan+l>n?e+1:e}),0);t.rowspan-=e,o[t.colId]+=1}))};for(l.s();!(e=l.n()).done;)s()}catch(t){l.e(t)}finally{l.f()}for(var d=0,u=0,h=Object.values(o);u<h.length;u++){if(0===h[u])for(var f=[],p=0,v=0,b=Object.values(n);v<b.length;v++){var m=b[v],g=f.shift()||0,y=[];p>0?(y=m.getCellByColumIndex(d-g)[2],p-=1):(y=m.removeCell(d-g)).skipRowNum&&(p+=y.skipRowNum);var w,x=c(y.entries());try{for(x.s();!(w=x.n()).done;){var k=C(w.value,2),I=k[0],T=k[1];f[I]=(f[I]||0)+T}}catch(t){x.e(t)}finally{x.f()}}else d+=1}var N,E=c(i);try{for(E.s();!(N=E.n()).done;){var S=N.value;0===o[S.colId]&&(S.prev?S.prev.width+=S.width:S.next&&(S.next.width+=S.width),S.remove())}}catch(t){E.e(t)}finally{E.f()}}},{key:"removeRow",value:function(t){if(!(t.length<=0)){var e,n=q(t[0],N.tableMain),i=n.getRows(),o=i.length,r=-1,a=c(t);try{for(a.s();!(e=a.n()).done;){var l=e.value,s=q(l,N.tableRow),d=i.indexOf(s);d<o&&(o=d),d+l.rowspan>r&&(r=d+l.rowspan)}}catch(t){a.e(t)}finally{a.f()}for(var u={},h=function(t){i[t].foreachCellInner((function(e){e.rowspan+t>r&&(u[e.colId]={rowspan:e.rowspan+t-r,colspan:e.colspan,colIndex:e.getColumnIndex()}),e.parent.remove()}))},f=o;f<Math.min(i.length,r);f++)h(f);if(i[r])for(var p=i[r],v=n.tableId,b=0,m=Object.entries(u);b<m.length;b++){var g=C(m[b],2),y=g[0],w=g[1],x=w.colIndex,M=w.colspan,k=w.rowspan;p.insertCell(x,{tableId:v,rowId:p.rowId,colId:y,colspan:M,rowspan:k})}this.fixTableByRemove(n)}}},{key:"removeCol",value:function(t){if(!(t.length<=0)){var e,n=t[0],i=q(n,N.tableMain),o={},r=c(t);try{for(r.s();!(e=r.n()).done;){var a=e.value;o[a.rowId]||(o[a.rowId]=0),o[a.rowId]+=a.colspan}}catch(t){r.e(t)}finally{r.f()}for(var l=Math.max.apply(Math,M(Object.values(o))),s=n.getColumnIndex(),d=i.descendants(Ae),u=0;u<l;u++)for(var h=[],f=0,p=0,v=Object.values(d);p<v.length;p++){var b=v[p],m=h.shift()||0;if(f>0)f-=1;else{var g=b.removeCell(s-m);g.skipRowNum&&(f+=g.skipRowNum);var y,w=c(g.entries());try{for(w.s();!(y=w.n()).done;){var x=C(y.value,2),k=x[0],I=x[1];h[k]=(h[k]||0)+I}}catch(t){w.e(t)}finally{w.f()}}}var T=C(i.descendants(Ye),1)[0];if(T)for(var E=0;E<l;E++)T.removeColByIndex(s);this.fixTableByRemove(i)}}},{key:"mergeCells",value:function(t){if(!(t.length<=1)){var e=t.reduce((function(t,e,n){var i=e.colId;t[0][i]||(t[0][i]=0),t[0][i]+=e.rowspan;var o=e.rowId;return t[1][o]||(t[1][o]=0),t[1][o]+=e.colspan,0!==n&&(e.moveChildren(t[2]),e.parent.remove()),t}),[{},{},t[0]]),n=Math.max.apply(Math,M(Object.values(e[0]))),i=Math.max.apply(Math,M(Object.values(e[1]))),o=e[2];o.colspan=i,o.rowspan=n;var r=q(o,N.tableMain);this.fixTableByRemove(r)}}},{key:"splitCell",value:function(t){if(1===t.length){var e=t[0];if(1!==e.colspan||1!==e.rowspan){var n=C(W(e,[N.tableMain,N.tableRow]),2),i=n[0],o=n[1],r=i.tableId,a=e.getColumnIndex(),l=i.getColIds().slice(a,a+e.colspan).reverse(),s=o,d=e.rowspan;for(e.colspan=1,e.rowspan=1;s&&d>0;){var u,h=c(l);try{for(h.s();!(u=h.n()).done;){var f=u.value;s===o&&f===e.colId||s.insertCell(a+(s===o?1:0),{tableId:r,rowId:s.rowId,colId:f,rowspan:1,colspan:1})}}catch(t){h.e(t)}finally{h.f()}d-=1,s=s.next}}}}}],[{key:"register",value:function(){var t;Ke.allowedChildren=[Ue],Ue.allowedChildren=[ze,Ye,_e],Ue.requiredContainer=Ke,_e.requiredContainer=Ue,Ye.allowedChildren=[Xe],Ye.requiredContainer=Ue,ze.allowedChildren=[Ae],ze.requiredContainer=Ue,Ae.allowedChildren=[Ve],Ve.requiredContainer=ze,Ve.allowedChildren=[Oe,In],Ve.requiredContainer=Ae,Oe.requiredContainer=Ve;var n=["header","list","blockquote","code-block"].reduce((function(t,n){var i="formats/".concat(n),o=e.import(i);return t[i]=function(t){function e(){return a(this,e),r(this,e,arguments)}return f(e,t),s(e,null,[{key:"register",value:function(){}}])}(function(t,e){var n,i=function(t){function e(){a(this,e);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r(this,e,[].concat(n))}return f(e,t),s(e)}(t),o=c(e);try{for(o.s();!(n=o.n()).done;){var l=n.value;j(i.prototype,l.prototype)}}catch(t){o.e(t)}finally{o.f()}return i}(o,[We])),t}),{});e.register(b(b({"blots/scroll":De,"blots/block":We},n),{},(d(d(d(d(d(d(d(d(d(d(t={},"blots/".concat(N.container),Se),"formats/".concat(N.tableCell),Ve),"formats/".concat(N.tableCellInner),Oe),"formats/".concat(N.tableRow),Ae),"formats/".concat(N.tableBody),ze),"formats/".concat(N.tableCol),Xe),"formats/".concat(N.tableColgroup),Ye),"formats/".concat(N.tableCaption),_e),"formats/".concat(N.tableMain),Ue),"formats/".concat(N.tableWrapper),Ke),d(t,"modules/clipboard",rn))),!0)}}]);var t}();d(En,"moduleName",L.moduleName),d(En,"toolName",N.tableWrapper),d(En,"keyboradHandler",{"forbid remove table by backspace":{bindInHead:!0,key:"Backspace",collapsed:!0,offset:0,handler:function(t,e){var n=this.quill.getLine(t.index)[0];if(n.prev instanceof Ke)return n.prev.remove(),!1;if(e.format[N.tableCellInner]&&0===n.offset(q(n,N.tableCellInner)))return!1;return!0}},"forbid remove table by delete":{bindInHead:!0,key:"Delete",collapsed:!0,handler:function(t,e){var n=this.quill.getLine(t.index),i=n[0],o=n[1];if((i.next instanceof Ke||i.next instanceof Xe)&&o===i.length()-1)return!1;if(e.format[N.tableCellInner]&&(i===q(i,N.tableCellInner).children.tail&&o===i.length()-1))return!1;return!0}},"table up":Nn(!0),"table down":Nn(!1),"table caption break":{bindInHead:!0,key:"Enter",shiftKey:null,format:[N.tableCaption],handler:function(t,e){return!1}}}),t.BlockOverride=We,t.ContainerFormat=Se,t.ScrollOverride=De,t.Scrollbar=gn,t.TableAlign=$e,t.TableBodyFormat=ze,t.TableCaptionFormat=_e,t.TableCellFormat=Ve,t.TableCellInnerFormat=Oe,t.TableClipboard=rn,t.TableColFormat=Xe,t.TableColgroupFormat=Ye,t.TableMainFormat=Ue,t.TableMenuCommon=dn,t.TableMenuContextmenu=un,t.TableMenuSelect=hn,t.TableResizeBox=vn,t.TableResizeCommon=pn,t.TableResizeLine=bn,t.TableResizeScale=mn,t.TableRowFormat=Ae,t.TableSelection=wn,t.TableUp=En,t.TableVirtualScrollbar=yn,t.TableWrapperFormat=Ke,t.blotName=N,t.createColorPicker=Q,t.createSelectBox=ot,t.createTooltip=pe,t.default=En,t.defaultCustomSelect=function(t,e){return ot({onSelect:function(n,i){t.insertTable(n,i),e&&e.close()},customBtn:t.options.customBtn,texts:t.options.texts})},t.findParentBlot=q,t.findParentBlots=W,t.getTableMainRect=Ze,t.isTableAlignRight=fn,t.randomId=Me,t.tableMenuTools=ln,t.tableUpEvent=S,t.tableUpInternal=L,t.tableUpSize=E,t.updateTableConstants=function(t){O.delete(N.tableCellInner),Object.assign(N,t.blotName||{}),Object.assign(E,t.tableUpSize||{}),Object.assign(S,t.tableUpEvent||{}),Object.assign(L,t.tableUpInternal||{}),En.moduleName=L.moduleName,En.toolName=N.tableWrapper,Se.blotName=N.container,Ke.blotName=N.tableWrapper,Ue.blotName=N.tableMain,Ye.blotName=N.tableColgroup,Xe.blotName=N.tableCol,ze.blotName=N.tableBody,Ae.blotName=N.tableRow,Ve.blotName=N.tableCell,Oe.blotName=N.tableCellInner,O.add(N.tableCellInner)},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.js.map
